<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>Picking</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/jMonkeyEngine/wiki/edit/master/src/docs/asciidoc/jme3/contributions/cubes/tools/picking.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/jMonkeyEngine/wiki/new/master/src/docs/asciidoc/jme3/contributions/cubes/tools/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>Picking</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1"><li><a href="#blocknavigator">BlockNavigator</a></li><li><a href="#get-the-cursor-pointed-location-raycasting">Get the cursor-pointed location / RayCasting</a></li><li><a href="#woah-let-s-build-minecraft">Woah - Let&#8217;s build Minecraft!</a></li><li><a href="#further-improvements">Further improvements</a></li></ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="paragraph"><p>You already found out how to create a world block and modify it from your code. But wouldn&#8217;t it be nice to have a “click-and-build functionality? (Minecraft says hello)</p></div>
<div class="paragraph"><p>The framework helps you to get the block location which is e.g. pointed by your mouse - When receiving the coordinates, you can use them to add or remove a block there.</p></div></div></div>
<div class="sect1"><h2 id="blocknavigator">BlockNavigator</h2><div class="sectionbody"><div class="paragraph"><p>The <code>BlockNavigator</code> class contains various methods to help you navigate through your blockworld without having to trouble with coordinates, type casts or chunks. The method we need for (mouse) picking is this one:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> Vector3Int getPointedBlockLocation(BlockTerrain blockTerrain, Vector3f collisionContactPoint, <span class="type">boolean</span> getNeighborLocation){
    <span class="comment">//Some mysterious code that returns the location</span>
    <span class="comment">//of the block in the terrain, which is placed</span>
    <span class="comment">//at the specified collisionContactPoint (world coordinates)</span>
    <span class="comment">//If you set getNeighborLocation to true, you can</span>
    <span class="comment">//get the empty block gap, in the direction towards you</span>
    <span class="comment">//(e.g. if you want to add a block to the block you've clicked)</span>
}</code></pre></div></div></div></div>
<div class="sect1"><h2 id="get-the-cursor-pointed-location-raycasting">Get the cursor-pointed location / RayCasting</h2><div class="sectionbody"><div class="paragraph"><p>So, the above method needs a collisionContactPoint - This is the point you&#8217;ve clicked in your world. Luckily, jMonkeyEngine offers raycasting, which lets you get exactly this point.</p></div>
<div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content"><div class="paragraph"><p>I recommend to read the <a href="../../../../jme3/beginner/hello_picking.html">Hello Picking</a> tutorial first, since the rest of this chapter has nothing to do with the “Cubes framework itself.</p></div></td></tr></table></div>
<div class="paragraph"><p>This is a method I&#8217;ve created while creating a test case for mouse picking in the blockworld - It returns the CollisionResults of the mouse cursor and a specified node: (Generally, this will be the BlockTerrain&#8217;s node)</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> CollisionResults getRayCastingResults(Node node){
    Vector3f origin = cam.getWorldCoordinates(<span class="keyword">new</span> Vector2f((settings.getWidth() / <span class="integer">2</span>), (settings.getHeight() / <span class="integer">2</span>)), <span class="float">0.0f</span>);
    Vector3f direction = cam.getWorldCoordinates(<span class="keyword">new</span> Vector2f((settings.getWidth() / <span class="integer">2</span>), (settings.getHeight() / <span class="integer">2</span>)), <span class="float">0.3f</span>);
    direction.subtractLocal(origin).normalizeLocal();
    Ray ray = <span class="keyword">new</span> Ray(origin, direction);
    CollisionResults results = <span class="keyword">new</span> CollisionResults();
    node.collideWith(ray, results);
    <span class="keyword">return</span> results;
}</code></pre></div></div>
<div class="paragraph"><p>You can use the closest CollisionResult to receive the collisionContactPoint with your BlockTerrain and to finally get the “pointed block location:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> Vector3Int getCurrentPointedBlockLocation(<span class="type">boolean</span> getNeighborLocation){
    CollisionResults results = getRayCastingResults(terrainNode);
    <span class="keyword">if</span>(results.size() &gt; <span class="integer">0</span>){
        Vector3f collisionContactPoint = results.getClosestCollision().getContactPoint();
        <span class="keyword">return</span> BlockNavigator.getPointedBlockLocation(blockTerrain, collisionContactPoint, getNeighborLocation);
    }
    <span class="keyword">return</span> <span class="predefined-constant">null</span>;
}</code></pre></div></div>
<div class="paragraph"><p>Time to sum up: You can now get the current block location that you point with your mouse at any time you want. :)</p></div></div></div>
<div class="sect1"><h2 id="woah-let-s-build-minecraft">Woah - Let&#8217;s build Minecraft!</h2><div class="sectionbody"><div class="paragraph"><p>One nice example would be to register a mouse-listener (See <a href="../../../../jme3/beginner/hello_input_system.html">Hello Input</a>) and to execute the following code when the user clicks:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//Get the free block gap, to which the user is loooking...</span>
Vector3Int blockLocation = getCurrentPointedBlockLocation(<span class="predefined-constant">true</span>);
<span class="comment">//(The block location is null, if the user looks in the sky or out of the map)</span>
<span class="keyword">if</span>(blockLocation != <span class="predefined-constant">null</span>){
    <span class="comment">//... and place a block there :)</span>
    blockTerrain.setBlock(blockLocation, CubesTestAssets.BLOCK_WOOD);
}</code></pre></div></div>
<div class="paragraph"><p>And that&#8217;s it - You just created your own minecraft-like blockworld-editor. Give yourself a challenge and implement the other mouse button to remove the pointed block (Look out for the <code>getNeighborLocation</code> parameter).</p></div>
<div class="paragraph"><p><span class="image"><img src="http://destroflyer.mania-community.de/other/imagehost/cubes/test_picking.png" alt="test_picking.png" width="800" height=""></span></p></div></div></div>
<div class="sect1"><h2 id="further-improvements">Further improvements</h2><div class="sectionbody"><div class="ulist"><ul><li><p>Create different types of interactions between player and block (Open a door, turn a switch, destroy a block, …) and a way to define own interactions</p></li></ul></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2017-11-14 05:28:25 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>