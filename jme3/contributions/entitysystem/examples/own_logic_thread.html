<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>Your Own Logic Thread</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/jMonkeyEngine/wiki/edit/master/src/docs/asciidoc/jme3/contributions/entitysystem/examples/own_logic_thread.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/jMonkeyEngine/wiki/new/master/src/docs/asciidoc/jme3/contributions/entitysystem/examples/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>Your Own Logic Thread</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1"><li><a href="#gamelogic-class">GameLogic class</a></li><li><a href="#application">Application</a></li></ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="paragraph"><p>You can add AppStates to the SimpleApplication and your whole program will run on a single thread.
This can have benefits, but this Entity System is optimized to run on several Threads.
Because of this, it is recommended that you run the game logic in a separate thread and independent from the framerate.
In this example, we will say that we want to run the game logic every 20 milliseconds. This means 50 updates per second and a tpf value of 0.2f   .</p></div></div></div>
<div class="sect1"><h2 id="gamelogic-class">GameLogic class</h2><div class="sectionbody"><div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">GameLogicThread</span> <span class="directive">implements</span> <span class="predefined-type">Runnable</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="type">float</span> tpf = <span class="float">0.02f</span>;
    <span class="directive">private</span> AppStateManager stateManager;

    <span class="directive">public</span> GameLogicThread(Application app) {
        stateManager = <span class="keyword">new</span> AppStateManager(app);

        <span class="comment">//add the logic AppStates to this thread</span>
        stateManager.attach(<span class="keyword">new</span> MovementAppState());
        stateManager.attach(<span class="keyword">new</span> ExpiresAppState());
        stateManager.attach(<span class="keyword">new</span> CollisionAppState());
        stateManager.attach(<span class="keyword">new</span> EnemyAppState());
    }

    <span class="directive">public</span> <span class="type">void</span> run() {
        stateManager.update(tpf);
    }
}</code></pre></div></div></div></div>
<div class="sect1"><h2 id="application">Application</h2><div class="sectionbody"><div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Example</span> <span class="directive">extends</span> SimpleApplication {

    <span class="directive">private</span> EntitySystem entitySystem;
    <span class="directive">private</span> <span class="predefined-type">ScheduledExecutorService</span> exec;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleInitApp() {

        <span class="comment">//Init the Entity System</span>
        entitySystem = <span class="keyword">new</span> EntitySystem(<span class="keyword">new</span> MapEntityData());

        <span class="comment">//Init the Game Systems for the visualisation</span>
        stateManager.attach(<span class="keyword">new</span> EntityDisplayAppState(rootNode));
        stateManager.attach(<span class="keyword">new</span> PlayerInputAppState());

        <span class="comment">//create the Thread for the game logic</span>
        exec = <span class="predefined-type">Executors</span>.newSingleThreadScheduledExecutor();
        exec.scheduleAtFixedRate(<span class="keyword">new</span> GameLogicThread(<span class="local-variable">this</span>), <span class="integer">0</span>, <span class="integer">20</span>, <span class="predefined-type">TimeUnit</span>.MILLISECONDS);
    }

    <span class="directive">public</span> EntitySystem getEntitySystem() {
        <span class="keyword">return</span> entitySystem;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroy() {
        <span class="local-variable">super</span>.destroy();
        <span class="comment">//Shutdown the thread when the game is closed</span>
        exec.shutdown();
    }
}</code></pre></div></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2017-11-14 05:28:25 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>