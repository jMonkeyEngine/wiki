<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>User Example: Third Person Camera</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/jMonkeyEngine/wiki/edit/master/src/docs/asciidoc/jme3/user_examples/thirdpersoncamera.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/jMonkeyEngine/wiki/new/master/src/docs/asciidoc/jme3/user_examples/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>User Example: Third Person Camera</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1"><li><a href="#how-the-mouselook-works">How the mouselook works</a></li><li><a href="#source-code">Source Code</a><ul class="sectlevel2"><li><a href="#thirdpersonplayernode-java">ThirdPersonPlayerNode.java</a></li><li><a href="#thirdpersoncamera-java">ThirdPersonCamera.java</a></li><li><a href="#main-java">Main.java</a></li></ul></li></ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="paragraph"><p><span class="image"><img src="../../jme3/user_examples/thirdpersoncamera/3p.png" alt="3p.png" width="" height=""></span></p></div>
<div class="paragraph"><p>(by Berzee) (see a video demonstration here: <a href="https://www.youtube.com/watch?v=phu52hmIoYU">https://www.youtube.com/watch?v=phu52hmIoYU</a>)</p></div>
<div class="paragraph"><p>Here is a small example of a self-contained Third Person Character (with camera). It uses the familiar Green Ninja model to demonstrate the following controls and animations:</p></div>
<div class="ulist"><ul><li><p>“WASD movement</p></li><li><p>“SPACE to jump</p></li><li><p>Horizontal mouse movement to turn left and right</p></li><li><p>Vertical mouselook (camera pivots around character)</p></li><li><p>Left Mouse Button to attack</p></li></ul></div>
<div class="paragraph"><p>To try this example for yourself, you can copy the classes from this page. Then you will be able to create a Third-Person Character in your apps like so:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">player = <span class="keyword">new</span> ThirdPersonPlayerNode(playerModel, inputManager, cam);
rootNode.attachChild(player);
bulletAppState.getPhysicsSpace().add(player);

<span class="comment">//make sure to call &quot;player.update()&quot; in the app's update method, too</span></code></pre></div></div></div></div>
<div class="sect1"><h2 id="how-the-mouselook-works">How the mouselook works</h2><div class="sectionbody"><div class="paragraph"><p>Most of the code in the example files should be relatively self-explanatory, but mouselook deserves a lovely pictograph of its own. It&#8217;s easy to make <a href="../../jme3/advanced/making_the_camera_follow_a_character.html">a camera that follows an object and always looks at the back of it</a>, and thus it&#8217;s easy to account for horizontal mouse movement by simple rotating the entire Player character left or right.</p></div>
<div class="paragraph"><p>But what if we want to be able to move the camera angle up or down, while the Player stays firmly upright? We can accomplish this with minimal Horrible Maths by adding an invisible “pivot node to the Player, and instructing the camera to follow that “pivot instead. Then we can independently rotate the <strong>pivot</strong> instead of the Player, and do things like this:</p></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/user_examples/thirdpersoncamera/pivot2.png" alt="pivot2.png" width="" height=""></span></p></div>
<div class="paragraph"><p>Now you know the mystical secrets, and are ready to see the code itself.</p></div></div></div>
<div class="sect2"><h3 id="source-code">Source Code</h3><div class="sect2"><h3 id="thirdpersonplayernode-java">ThirdPersonPlayerNode.java</h3><div class="paragraph"><p>ThirdPersonPlayerNode.java contains the bulk of the logic for keyboard, mouse, physics, and animation. Most of this is lifted straight from the Tutorials for Beginners and can safely be ignored. However, pay particular attention to the “onAnalog() method – that&#8217;s where all of the mouse movement is processed to turn the player left and right, and the camera up and down.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mygame</span>;

<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimChannel</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimEventListener</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.LoopMode</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.collision.shapes.CapsuleCollisionShape</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.control.CharacterControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.InputManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.KeyInput</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.MouseInput</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.controls.ActionListener</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.controls.AnalogListener</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.controls.KeyTrigger</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.controls.MouseAxisTrigger</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.controls.MouseButtonTrigger</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.FastMath</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Quaternion</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.Camera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;

<span class="comment">/**
 *
 * @author Berzee
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ThirdPersonPlayerNode</span> <span class="directive">extends</span> Node <span class="directive">implements</span> <span class="predefined-type">ActionListener</span>, AnalogListener, AnimEventListener
{
    <span class="comment">//ThirdPersonCameraNode automatically sets itself up to follow a target</span>
    <span class="comment">//object. Check the &quot;onAnalog&quot; function here to see how we do mouselook.</span>
    <span class="directive">private</span> ThirdPersonCamera camera;
    <span class="directive">private</span> Camera cam;

    <span class="directive">private</span> Spatial model;
    <span class="directive">private</span> CharacterControl characterControl;
    <span class="directive">private</span> AnimChannel animChannel;
    <span class="directive">private</span> AnimControl animControl;
    <span class="directive">private</span> InputManager inputManager;
    <span class="directive">private</span> Vector3f walkDirection = <span class="keyword">new</span> Vector3f();

    <span class="directive">private</span> <span class="type">boolean</span> left = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="type">boolean</span> right = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="type">boolean</span> up = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="type">boolean</span> down = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="type">boolean</span> attack;
    <span class="directive">private</span> <span class="type">boolean</span> attacking;

    <span class="comment">//These can all be changed according to your whims.</span>
    <span class="directive">private</span> <span class="type">float</span> walkSpeed = <span class="float">.15f</span>;
    <span class="directive">private</span> <span class="type">float</span> mouselookSpeed = FastMath.PI;
    <span class="directive">private</span> <span class="type">float</span> jumpSpeed = <span class="integer">15</span>;
    <span class="directive">private</span> <span class="type">float</span> fallSpeed = <span class="integer">20</span>;
    <span class="directive">private</span> <span class="type">float</span> gravity = <span class="integer">25</span>;
    <span class="directive">private</span> <span class="type">float</span> stepSize = <span class="float">.05f</span>;

    <span class="comment">//Animation names. These are currently set up for the Ninja.mesh.xml from</span>
    <span class="comment">//jme3-test-data.jar (to add that jar to your project, right-click on</span>
    <span class="comment">//Libraries in the SDK project explorer, click &quot;Add Library&quot; and choose</span>
    <span class="comment">//jme3-test-data.jar from the menu).</span>
    <span class="comment">//</span>
    <span class="comment">//Alternatively, use any model you like and change these animation names</span>
    <span class="comment">//as needed.</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> idleAnim = <span class="string"><span class="delimiter">&quot;</span><span class="content">Idle1</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="predefined-type">String</span> walkAnim = <span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="predefined-type">String</span> attackAnim = <span class="string"><span class="delimiter">&quot;</span><span class="content">Attack3</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="predefined-type">String</span> jumpAnim = <span class="string"><span class="delimiter">&quot;</span><span class="content">Climb</span><span class="delimiter">&quot;</span></span>; <span class="comment">//hilarious</span>

    <span class="directive">public</span> ThirdPersonPlayerNode(Spatial model, InputManager inputManager, Camera cam)
    {
        <span class="local-variable">super</span>();
        <span class="local-variable">this</span>.cam = cam;
        camera = <span class="keyword">new</span> ThirdPersonCamera(<span class="string"><span class="delimiter">&quot;</span><span class="content">CamNode</span><span class="delimiter">&quot;</span></span>, cam, <span class="local-variable">this</span>);

        <span class="local-variable">this</span>.model = model;
        <span class="local-variable">this</span>.model.scale(<span class="float">.01f</span>); <span class="comment">//Ninja.mesh.xml-specific scale stuff</span>
        <span class="local-variable">this</span>.model.setLocalTranslation(<span class="float">0f</span>, -<span class="float">1f</span>, <span class="float">0f</span>); <span class="comment">//Ninja-specific</span>
        <span class="local-variable">this</span>.attachChild(<span class="local-variable">this</span>.model);

        CapsuleCollisionShape playerShape = <span class="keyword">new</span> CapsuleCollisionShape(<span class="float">.5f</span>,<span class="float">1f</span>); <span class="comment">//Ninja-specific</span>
        characterControl = <span class="keyword">new</span> CharacterControl(playerShape, stepSize);
        characterControl.setJumpSpeed(jumpSpeed);
        characterControl.setFallSpeed(fallSpeed);
        characterControl.setGravity(gravity);
        <span class="local-variable">this</span>.addControl(characterControl);

        animControl = model.getControl(AnimControl.class);
        animControl.addListener(<span class="local-variable">this</span>);
        animChannel = animControl.createChannel();
        animChannel.setAnim(idleAnim);

        <span class="local-variable">this</span>.inputManager = inputManager;
        setUpKeys();
    }

    <span class="comment">//Make sure to call this from the main simpleUpdate() loop</span>
    <span class="directive">public</span> <span class="type">void</span> update()
    {
        Vector3f camDir = cam.getDirection().clone();
        camDir.y = <span class="integer">0</span>;
        Vector3f camLeft = cam.getLeft().clone();
        camLeft.y = <span class="integer">0</span>;
        walkDirection.set(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>);

        <span class="keyword">if</span> (left)  { walkDirection.addLocal(camLeft); }
        <span class="keyword">if</span> (right) { walkDirection.addLocal(camLeft.negate()); }
        <span class="keyword">if</span> (up)    { walkDirection.addLocal(camDir); }
        <span class="keyword">if</span> (down)  { walkDirection.addLocal(camDir.negate()); }

        characterControl.setWalkDirection(walkDirection.normalize().multLocal(walkSpeed));

        handleAnimations();
    }

    <span class="directive">private</span> <span class="type">void</span> handleAnimations()
    {
        <span class="keyword">if</span>(attacking)
        {
            <span class="comment">//waiting for attack animation to finish</span>
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(attack)
        {

            animChannel.setAnim(attackAnim,<span class="float">.3f</span>);
            animChannel.setLoopMode(LoopMode.DontLoop);
            attack = <span class="predefined-constant">false</span>;
            attacking = <span class="predefined-constant">true</span>;
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(characterControl.onGround())
        {
            <span class="keyword">if</span>(left || right || up || down)
            {
                <span class="keyword">if</span>(!animChannel.getAnimationName().equals(walkAnim))
                {
                    animChannel.setAnim(walkAnim,<span class="float">.3f</span>);
                    animChannel.setLoopMode(LoopMode.Loop);
                }
            }
            <span class="keyword">else</span>
            {
                <span class="keyword">if</span>(!animChannel.getAnimationName().equals(idleAnim))
                {
                    animChannel.setAnim(idleAnim,<span class="float">.3f</span>);
                    animChannel.setLoopMode(LoopMode.Cycle);
                }
            }
        }
    }

    <span class="directive">private</span> <span class="type">void</span> setUpKeys()
    {
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">Left</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_A));
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">Right</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_D));
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">Up</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_W));
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">Down</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_S));
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">Jump</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_SPACE));
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> MouseButtonTrigger(MouseInput.BUTTON_LEFT));
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">TurnLeft</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> MouseAxisTrigger(MouseInput.AXIS_X,<span class="predefined-constant">true</span>));
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">TurnRight</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> MouseAxisTrigger(MouseInput.AXIS_X,<span class="predefined-constant">false</span>));
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">MouselookDown</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> MouseAxisTrigger(MouseInput.AXIS_Y,<span class="predefined-constant">true</span>));
        inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">MouselookUp</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> MouseAxisTrigger(MouseInput.AXIS_Y,<span class="predefined-constant">false</span>));
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Left</span><span class="delimiter">&quot;</span></span>);
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Right</span><span class="delimiter">&quot;</span></span>);
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Up</span><span class="delimiter">&quot;</span></span>);
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Down</span><span class="delimiter">&quot;</span></span>);
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Jump</span><span class="delimiter">&quot;</span></span>);
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>);
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">TurnLeft</span><span class="delimiter">&quot;</span></span>);
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">TurnRight</span><span class="delimiter">&quot;</span></span>);
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">MouselookDown</span><span class="delimiter">&quot;</span></span>);
        inputManager.addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">MouselookUp</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="directive">public</span> <span class="type">void</span> onAction(<span class="predefined-type">String</span> binding, <span class="type">boolean</span> value, <span class="type">float</span> tpf) {
        <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Left</span><span class="delimiter">&quot;</span></span>))
        {
            left = value;
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Right</span><span class="delimiter">&quot;</span></span>))
        {
            right = value;
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Up</span><span class="delimiter">&quot;</span></span>))
        {
            up = value;
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Down</span><span class="delimiter">&quot;</span></span>))
        {
            down = value;
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Jump</span><span class="delimiter">&quot;</span></span>))
        {
            <span class="keyword">if</span>(characterControl.onGround())
            {
                characterControl.jump();
                <span class="keyword">if</span>(!attacking)
                {
                    animChannel.setAnim(jumpAnim,<span class="float">.3f</span>);
                    animChannel.setLoopMode(LoopMode.Loop);
                }
            }
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attack</span><span class="delimiter">&quot;</span></span>))
        {
            attack = value;
        }
    }

    <span class="comment">//Analog handler for mouse movement events.</span>
    <span class="comment">//It is assumed that we want horizontal movements to turn the character,</span>
    <span class="comment">//while vertical movements only make the camera rotate up or down.</span>
    <span class="directive">public</span> <span class="type">void</span> onAnalog(<span class="predefined-type">String</span> binding, <span class="type">float</span> value, <span class="type">float</span> tpf)
    {
        <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">TurnLeft</span><span class="delimiter">&quot;</span></span>))
        {
            Quaternion turn = <span class="keyword">new</span> Quaternion();
            turn.fromAngleAxis(mouselookSpeed*value, Vector3f.UNIT_Y);
            characterControl.setViewDirection(turn.mult(characterControl.getViewDirection()));
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">TurnRight</span><span class="delimiter">&quot;</span></span>))
        {
            Quaternion turn = <span class="keyword">new</span> Quaternion();
            turn.fromAngleAxis(-mouselookSpeed*value, Vector3f.UNIT_Y);
            characterControl.setViewDirection(turn.mult(characterControl.getViewDirection()));
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">MouselookDown</span><span class="delimiter">&quot;</span></span>))
        {
            camera.verticalRotate(mouselookSpeed*value);
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">MouselookUp</span><span class="delimiter">&quot;</span></span>))
        {
            camera.verticalRotate(-mouselookSpeed*value);
        }
    }

    <span class="directive">public</span> <span class="type">void</span> onAnimCycleDone(AnimControl control, AnimChannel channel, <span class="predefined-type">String</span> animName)
    {
        <span class="keyword">if</span>(channel == animChannel &amp;&amp; attacking &amp;&amp; animName.equals(attackAnim))
        {
            attacking = <span class="predefined-constant">false</span>;
        }
    }

    <span class="directive">public</span> <span class="type">void</span> onAnimChange(AnimControl control, AnimChannel channel, <span class="predefined-type">String</span> animName)
    {
    }

    <span class="directive">public</span> CharacterControl getCharacterControl()
    {
        <span class="keyword">return</span> characterControl;
    }

    <span class="directive">public</span> ThirdPersonCamera getCameraNode()
    {
        <span class="keyword">return</span> camera;
    }
}</code></pre></div></div></div>
<div class="sect2"><h3 id="thirdpersoncamera-java">ThirdPersonCamera.java</h3><div class="paragraph"><p>ThirdPersonCamera.java sets up a CameraNode to follow behind the player. It uses the same “ControlDirection.SpatialToCamera approach as <a href="../../jme3/advanced/making_the_camera_follow_a_character.html">the advanced tutorial about 3rd-person cameras</a>, but also adds a pivot node for easy mouselook. (See the scientific diagram above, and the comments in the class, for more explanation).</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mygame</span>;

<span class="keyword">import</span> <span class="include">com.jme3.math.FastMath</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.Camera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.CameraNode</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.CameraControl</span>;

<span class="comment">/**
 *
 * @author Berzee
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ThirdPersonCamera</span>
{
    <span class="comment">//The &quot;pivot&quot; Node allows for easy third-person mouselook! It's actually</span>
    <span class="comment">//just an empty Node that gets attached to the center of the Player.</span>
    <span class="comment">//</span>
    <span class="comment">//The CameraNode is set up to always position itself behind the *pivot*</span>
    <span class="comment">//instead of behind the Player. So when we want to mouselook around the</span>
    <span class="comment">//Player, we simply need to spin the pivot! The camera will orbit behind it</span>
    <span class="comment">//while the Player object remains still.</span>
    <span class="comment">//</span>
    <span class="comment">//NOTE: Currently only vertical mouselook (around the X axis) is working.</span>
    <span class="comment">//The other two axes could be added fairly easily, once you have an idea</span>
    <span class="comment">//for how they should actually behave (min and max angles, et cetera).</span>
    <span class="directive">private</span> Node pivot;
    <span class="directive">private</span> CameraNode cameraNode;

    <span class="comment">//Change these as you desire. Lower verticalAngle values will put the camera</span>
    <span class="comment">//closer to the ground.</span>
    <span class="directive">public</span> <span class="type">float</span> followDistance = <span class="integer">7</span>;
    <span class="directive">public</span> <span class="type">float</span> verticalAngle = <span class="integer">30</span> * FastMath.DEG_TO_RAD;

    <span class="comment">//These bounds keep the camera from spinning too far and clipping through</span>
    <span class="comment">//the floor or turning upside-down. You can change them as needed but it is</span>
    <span class="comment">//recommended to keep the values in the (-90,90) range.</span>
    <span class="directive">public</span> <span class="type">float</span> maxVerticalAngle = <span class="integer">85</span> * FastMath.DEG_TO_RAD;
    <span class="directive">public</span> <span class="type">float</span> minVerticalAngle = <span class="integer">5</span> * FastMath.DEG_TO_RAD;

    <span class="directive">public</span> ThirdPersonCamera(<span class="predefined-type">String</span> name, Camera cam, Node player)
    {
        pivot = <span class="keyword">new</span> Node(<span class="string"><span class="delimiter">&quot;</span><span class="content">CamTrack</span><span class="delimiter">&quot;</span></span>);
        player.attachChild(pivot);

        cameraNode = <span class="keyword">new</span> CameraNode(name, cam);
        cameraNode.setControlDir(CameraControl.ControlDirection.SpatialToCamera);
        pivot.attachChild(cameraNode);
        cameraNode.setLocalTranslation(<span class="keyword">new</span> Vector3f(<span class="integer">0</span>, <span class="integer">0</span>, followDistance));
        cameraNode.lookAt(pivot.getLocalTranslation(), Vector3f.UNIT_Y);

        pivot.getLocalRotation().fromAngleAxis(-verticalAngle, Vector3f.UNIT_X);
    }

    <span class="directive">public</span> <span class="type">void</span> verticalRotate(<span class="type">float</span> angle)
    {
        verticalAngle += angle;

        <span class="keyword">if</span>(verticalAngle &gt; maxVerticalAngle)
        {
            verticalAngle = maxVerticalAngle;
        }
        <span class="keyword">else</span> <span class="keyword">if</span>(verticalAngle &lt; minVerticalAngle)
        {
            verticalAngle = minVerticalAngle;
        }

        pivot.getLocalRotation().fromAngleAxis(-verticalAngle, Vector3f.UNIT_X);
    }

    <span class="directive">public</span> CameraNode getCameraNode()
    {
        <span class="keyword">return</span> cameraNode;
    }

    <span class="directive">public</span> Node getCameraTrack()
    {
        <span class="keyword">return</span> pivot;
    }
}</code></pre></div></div></div>
<div class="sect2"><h3 id="main-java">Main.java</h3><div class="paragraph"><p>Here is an example Main.java project that you can use to see the ThirdPersonPlayerNode in action. Just make sure to add the jme3-test-data.jar library to your project so it can access the Ninja model and ManyLights scene (In the SDK: Project Explorer → Right Click on “Libraries → Add Library → jme3-test-data.jar).</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mygame</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.SimpleApplication</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.BulletAppState</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.collision.shapes.CollisionShape</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.control.RigidBodyControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.util.CollisionShapeFactory</span>;
<span class="keyword">import</span> <span class="include">com.jme3.light.DirectionalLight</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.RenderManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;

<span class="comment">/**
 * @author Berzee
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Main</span> <span class="directive">extends</span> SimpleApplication
{
    <span class="directive">private</span> Spatial sceneModel;
    <span class="directive">private</span> RigidBodyControl scene;
    <span class="directive">private</span> BulletAppState bulletAppState;
    <span class="directive">private</span> ThirdPersonPlayerNode player;

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        Main app = <span class="keyword">new</span> Main();
        app.start();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleInitApp() {
        mouseInput.setCursorVisible(<span class="predefined-constant">false</span>);
        flyCam.setEnabled(<span class="predefined-constant">false</span>);

        bulletAppState = <span class="keyword">new</span> BulletAppState();
        stateManager.attach(bulletAppState);
        <span class="comment">//bulletAppState.getPhysicsSpace().enableDebug(assetManager);</span>

        sceneModel = assetManager.loadModel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Scenes/ManyLights/Main.scene</span><span class="delimiter">&quot;</span></span>);
        sceneModel.scale(<span class="float">1f</span>,<span class="float">.5f</span>,<span class="float">1f</span>); <span class="comment">//Make scenery short enough to jump on. =P</span>
        CollisionShape sceneShape = CollisionShapeFactory.createMeshShape((Node) sceneModel);
        scene = <span class="keyword">new</span> RigidBodyControl(sceneShape, <span class="integer">0</span>);
        sceneModel.addControl(scene);
        rootNode.attachChild(sceneModel);
        bulletAppState.getPhysicsSpace().add(scene);

        Spatial playerModel = assetManager.loadModel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Models/Ninja/Ninja.mesh.xml</span><span class="delimiter">&quot;</span></span>);
        player = <span class="keyword">new</span> ThirdPersonPlayerNode(playerModel, inputManager, cam);
        player.getCharacterControl().setPhysicsLocation(<span class="keyword">new</span> Vector3f(-<span class="float">5f</span>,<span class="float">2f</span>,<span class="float">5f</span>));
        rootNode.attachChild(player);
        bulletAppState.getPhysicsSpace().add(player);

        <span class="comment">// You must add a light to make the model visible</span>
        DirectionalLight sun = <span class="keyword">new</span> DirectionalLight();
        sun.setDirection(<span class="keyword">new</span> Vector3f(-<span class="float">.1f</span>, -<span class="float">.7f</span>, -<span class="float">1f</span>));
        rootNode.addLight(sun);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleUpdate(<span class="type">float</span> tpf)
    {
        player.update();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleRender(RenderManager rm)
    {
        <span class="comment">//TODO: add render code</span>
    }
}</code></pre></div></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2017-11-14 05:28:25 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>