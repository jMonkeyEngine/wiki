<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>Endless Terrain</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/jMonkeyEngine/wiki/edit/master/src/docs/asciidoc/jme3/advanced/endless_terraingrid.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/jMonkeyEngine/wiki/new/master/src/docs/asciidoc/jme3/advanced/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>Endless Terrain</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1"><li><a href="#sample-code">Sample Code</a></li><li><a href="#specification">Specification</a></li><li><a href="#motivation">Motivation</a></li><li><a href="#rationale">Rationale</a></li><li><a href="#usage">Usage</a></li></ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content"><div class="paragraph"><p>Deprecated. Look at <a href="https://hub.jmonkeyengine.org/t/design-question-terrain/28771">https://hub.jmonkeyengine.org/t/design-question-terrain/28771</a> instead.</p></div></td></tr></table></div>
<div class="paragraph"><p>TerrainGrid is DEPRECATED.</p></div>
<div class="paragraph"><p>TerrainGrid is an extension built on top of the TerraMonkey tools like TerrainQuad and HeightMap, that provides “infinite Terrain paging routines. <br>
Thanks to Gábor (@anthyon) and Brent (@sploreg) for this contribution!</p></div></div></div>
<div class="sect1"><h2 id="sample-code">Sample Code</h2><div class="sectionbody"><div class="paragraph"><p>The classes with source code can be found in the org.jme3.terrain.geomipmapping and org.jme3.terrain.heightmap packages. Also there are 3 tests prepared in the jme3test.terrain package:</p></div>
<div class="ulist"><ul><li><p><a href="https://github.com/jMonkeyEngine/jmonkeyengine/blob/master/jme3-examples/src/main/java/jme3test/terrain/TerrainGridTest.java">TerrainGridTest.java</a>: uses an ImageBasedHeightMapGrid instance to load the tiles</p></li><li><p><a href="https://github.com/jMonkeyEngine/jmonkeyengine/blob/master/jme3-examples/src/main/java/jme3test/terrain/TerrainFractalGridTest.java">TerrainFractalGridTest.java</a>: makes use of the FractalHeightMapGrid class, and generates a terrain from noise</p></li><li><p><a href="https://github.com/jMonkeyEngine/jmonkeyengine/blob/master/jme3-examples/src/main/java/jme3test/terrain/TerrainGridAlphaMapTest.java">TerrainGridAlphaMapTest.java</a>: shows how to use TerrainGridListener to change the material of the tiles</p></li></ul></div></div></div>
<div class="sect1"><h2 id="specification">Specification</h2><div class="sectionbody"><div class="paragraph"><p>TerrainGrid is made up of the TerrainGrid class, and the HeightMapGrid and TerrainGridListener interfaces.</p></div>
<div class="ulist"><ul><li><p>TerrainGrid is the central class of the system. It takes care for handling camera movement in LODUpdate, loading and unloading terrain tiles on demand, and notifying any registered listeners of changes.</p></li><li><p>TerrainGridListener defines two events to listen to:</p><div class="ulist"><ul><li><p>gridMoved(Vector3f):  gets the new center as parameter after terrain update, so any objects can be added or removed as needed.</p></li><li><p>Material tileLoaded(Material material, Vector3f cell): notifies the system about a tile being loaded. Parameters are a cloned value of the material added to the TerrainGrid, and the cell of the new tile. The system can change the material according to this information (eg. load required alphamaps, etc).</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>Multiple listeners can be added to the TerrainGrid, they will be called in the order of addition, so it’s possible to have multiple changes to the material before completing the load of the tile.</p></div>
<div class="paragraph"><p>HeightMapGrid adds the possibility of loading terrain tiles on demand instead of having a simple height array. There’s no predefined way of how to store these tiles, it only takes care of loading one HeightMap object at given location at a time.</p></div></div></div>
<div class="sect1"><h2 id="motivation">Motivation</h2><div class="sectionbody"><div class="paragraph"><p>After playing around with the terrain in jME3, soon comes the requirement of having larger explorable lands. Increasing the size of one TerrainQuad leads to more memory usage, while it will still be easy to reach the worlds boundaries. That’s why TerrainGrid was designed. It extends the TerraindQuad class and uses 4 HeightMaps (dark blue) as the four sub-quad. This means that a terrain of size 513 will use tiles of 257. Also an LRUCache is built into the terrain package, so surrounding tiles (green) can be pre-cached on a different thread, lowering the loading time. The quads are updated as the camera approaches the boundary of the light blue section.</p></div></div></div>
<div class="sect1"><h2 id="rationale">Rationale</h2><div class="sectionbody"><div class="paragraph"><p>The design of the TerrainGrid system was chosen carefully, so that minimal effort needs to be taken to switch from previous TerrainQuad uses. It has the same constructors with the small exception that instead of an array of heightmap it takes a HeightMapGrid instance. All other parameters are forwarded down to the underlying TerrainQuad system.
There exist also two basic HeightMapGrid implementations:</p></div>
<div class="ulist"><ul><li><p>ImageBasedHeightMapGrid: uses a sequentially numbered, 16 bit grayscale heightmaps. The physical filename of these files can be generated through the Namer interface. When a tile cannot be found by the assetManager, an empty (all-zero) heightmap is created, and a warning is added to the log.</p></li><li><p>FractalHeightMapGrid: uses a noise library to create a landscape on the fly. The shape of the terrain can be controlled by the various parameters and postfilters of the fractals. With the help of this grid implementation there’s no limitation – above of floating point precision limits – how far the camera can get. The tiles generated this way can be cached to the filesystem, for later modification. The FractalHeightMapGrid will always load from cache if a tile exists there!</p></li></ul></div></div></div>
<div class="sect1"><h2 id="usage">Usage</h2><div class="sectionbody"><div class="olist arabic"><ol class="arabic"><li><p>instantiate a TerrainGrid object</p></li><li><p>set material, listeners, translation, scale, etc.</p></li><li><p>add a LODControl instance to the object</p></li><li><p>call initialize with the camera location</p></li><li><p>(optional) add it to the physicsSpace as you would a TerrainQuad</p></li></ol></div>
<div class="paragraph"><p>Further information about terrain and TerrainQuad can be found in the wiki at:</p></div>
<div class="ulist"><ul><li><p><a href="../../jme3/beginner/hello_terrain.html">jme3:beginner:hello_terrain</a></p></li><li><p><a href="../../jme3/advanced/terrain.html">jme3:advanced:terrain</a></p></li></ul></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2017-11-14 05:28:25 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>