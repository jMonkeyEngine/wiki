<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>Video</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/jMonkeyEngine/wiki/edit/master/src/docs/asciidoc/jme3/advanced/video.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/jMonkeyEngine/wiki/new/master/src/docs/asciidoc/jme3/advanced/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>Video</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div></div></div><div id="content"><div class="paragraph"><p>Relevant forum topics:</p></div>
<div class="paragraph"><p><a href="http://hub.jmonkeyengine.org/t/ive-made-a-movieappstate-so-you-dont-have-to/31673">http://hub.jmonkeyengine.org/t/ive-made-a-movieappstate-so-you-dont-have-to/31673</a></p></div>
<div class="paragraph"><p><a href="http://hub.jmonkeyengine.org/t/news-about-playing-videos-on-jme/30084/5">http://hub.jmonkeyengine.org/t/news-about-playing-videos-on-jme/30084/5</a></p></div>
<div class="paragraph"><p><a href="http://www.java-gaming.org/topics/java-media-player/27100/view.html">YUNPM - a Java Media Player</a> (java-gaming.org)</p></div>
<div class="paragraph"><p><a href="http://www.java-gaming.org/topics/gstlwjgl-yet-another-media-player/27146/view.html">GstLWJGL</a> (java-gaming.org)</p></div>
<div class="paragraph"><p><a href="http://jogamp.org/deployment/jogamp-next/javadoc/jogl/javadoc/com/jogamp/opengl/util/av/package-summary.html">GL Media Player</a> (jogamp.org)</p></div>
<div class="paragraph"><p><a href="http://www.xuggle.com/xuggler">Xuggler</a></p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa icon-warning" title="Warning"></i></td><td class="content"><div class="paragraph"><p>This <abbr title="Application Programming Interface">API</abbr> is deprecated.</p></div></td></tr></table></div>
<div class="paragraph"><p>jMonkeyEngine supports Jheora Ogg video (<code>com.jme3.video</code>).</p></div>
<div class="paragraph"><p>Full code sample here: <a href="http://code.google.com/p/jmonkeyengine/source/browse/trunk/engine/src/jheora/com/jme3/video/TestVideoPlayer.java">TestVideoPlayer.java</a></p></div>
<div class="paragraph"><p>You create either a file inputstream to load the video from your hard drive:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">FileInputStream</span>  fis = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">E:</span><span class="char">\\</span><span class="content">my_bunny.ogg</span><span class="delimiter">&quot;</span></span>);</code></pre></div></div>
<div class="paragraph"><p>Or you stream the video live from a web location:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">InputStream</span> fis = <span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://server/my_video.ogg</span><span class="delimiter">&quot;</span></span>).openStream();</code></pre></div></div>
<div class="paragraph"><p>Setting the queued frames to a value value higher than 5 (<code>videoQueue = new VQueue(5);</code>) will make web streamed playback smoother at the cost of memory.
Here is an example of video streaming in context:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">private</span> <span class="type">void</span> createVideo(){
        <span class="keyword">try</span> {
            <span class="predefined-type">InputStream</span> fis = <span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://mirrorblender.top-ix.org/peach/</span><span class="delimiter">&quot;</span></span>+
            <span class="string"><span class="delimiter">&quot;</span><span class="content">bigbuckbunny_movies/big_buck_bunny_480p_stereo.ogg</span><span class="delimiter">&quot;</span></span>).openStream();
            videoQueue = <span class="keyword">new</span> VQueue(<span class="integer">5</span>);               <span class="comment">// streaming quality vs memory</span>
            decoder = <span class="keyword">new</span> AVThread(fis, videoQueue);
            videoThread = <span class="keyword">new</span> <span class="predefined-type">Thread</span>(decoder, <span class="string"><span class="delimiter">&quot;</span><span class="content">Jheora Video Decoder</span><span class="delimiter">&quot;</span></span>);
            videoThread.setDaemon(<span class="predefined-constant">true</span>);
            videoThread.start();
            masterClock = decoder.getMasterClock();
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> ex) {
            ex.printStackTrace();
        }
    }</code></pre></div></div>
<div class="paragraph"><p>Use the simpleUpdate() method to play the audio:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleUpdate(<span class="type">float</span> tpf){
        <span class="keyword">if</span> (source == <span class="predefined-constant">null</span>){
            <span class="keyword">if</span> (decoder.getAudioStream() != <span class="predefined-constant">null</span>){
                source = <span class="keyword">new</span> AudioNode(decoder.getAudioStream(), <span class="predefined-constant">null</span>);
                source.setPositional(<span class="predefined-constant">false</span>);
                source.setReverbEnabled(<span class="predefined-constant">false</span>);
                audioRenderer.playSource(source);
            }<span class="keyword">else</span>{
                <span class="comment">// uncomment this statement to be able to play videos</span>
                <span class="comment">// without audio.</span>
                <span class="keyword">return</span>;
            }
        }

        <span class="keyword">if</span> (waitTime &gt; <span class="integer">0</span>){
            waitTime -= tpf;
            <span class="keyword">if</span> (waitTime &gt; <span class="integer">0</span>)
                <span class="keyword">return</span>;
            <span class="keyword">else</span>{
                waitTime = <span class="integer">0</span>;
                drawFrame(frameToDraw);
                frameToDraw = <span class="predefined-constant">null</span>;
            }
        }<span class="keyword">else</span>{
            VFrame frame;
            <span class="keyword">try</span> {
                frame = videoQueue.take();
            } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> ex){
                stop();
                <span class="keyword">return</span>;
            }
            <span class="keyword">if</span> (frame.getTime() &lt; lastFrameTime){
                videoQueue.returnFrame(frame);
                <span class="keyword">return</span>;
            }

            <span class="keyword">if</span> (frame.getTime() == -<span class="integer">2</span>){
                <span class="comment">// end of stream</span>
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">End of stream</span><span class="delimiter">&quot;</span></span>);
                stop();
                <span class="keyword">return</span>;
            }

            <span class="type">long</span> AV_SYNC_THRESHOLD = <span class="integer">1</span> * Clock.MILLIS_TO_NANOS;

            <span class="type">long</span> delay = frame.getTime() - lastFrameTime;
            <span class="type">long</span> diff = frame.getTime() - masterClock.getTime();
            <span class="type">long</span> syncThresh = delay &gt; AV_SYNC_THRESHOLD ? delay : AV_SYNC_THRESHOLD;

            <span class="comment">// if difference is more than 1 second, synchronize.</span>
            <span class="keyword">if</span> (<span class="predefined-type">Math</span>.abs(diff) &lt; Clock.SECONDS_TO_NANOS){
                <span class="keyword">if</span>(diff &lt;= -syncThresh) {
                  delay = <span class="integer">0</span>;
                } <span class="keyword">else</span> <span class="keyword">if</span>(diff &gt;= syncThresh) {
                  delay = <span class="integer">2</span> * delay;
                }
            }

            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">M: </span><span class="delimiter">&quot;</span></span>+decoder.getSystemClock().getTimeSeconds()+
                               <span class="string"><span class="delimiter">&quot;</span><span class="content">, V: </span><span class="delimiter">&quot;</span></span>+decoder.getVideoClock().getTimeSeconds()+
                               <span class="string"><span class="delimiter">&quot;</span><span class="content">, A: </span><span class="delimiter">&quot;</span></span>+decoder.getAudioClock().getTimeSeconds());

            <span class="keyword">if</span> (delay &gt; <span class="integer">0</span>){
                waitNanos(delay);
                drawFrame(frame);
            }<span class="keyword">else</span>{
                videoQueue.returnFrame(frame);
                lastFrameTime = frame.getTime();
            }
        }
    }</code></pre></div></div>
<div class="paragraph"><p>Helper Methods:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">private</span> <span class="type">void</span> drawFrame(VFrame frame){
        <span class="predefined-type">Image</span> image = frame.getImage();
        frame.setImage(image);
        picture.setTexture(assetManager, frame, <span class="predefined-constant">false</span>);

        <span class="comment">// note: this forces renderer to upload frame immediately,</span>
        <span class="comment">// since it is going to be returned to the video queue pool</span>
        <span class="comment">// it could be used again.</span>
        renderer.setTexture(<span class="integer">0</span>, frame);
        videoQueue.returnFrame(frame);
        lastFrameTime = frame.getTime();
    }</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">private</span> <span class="type">void</span> waitNanos(<span class="type">long</span> time){
        <span class="type">long</span> millis = (<span class="type">long</span>) (time / Clock.MILLIS_TO_NANOS);
        <span class="type">int</span> nanos   = (<span class="type">int</span>) (time - (millis * Clock.MILLIS_TO_NANOS));

        <span class="keyword">try</span> {
            <span class="predefined-type">Thread</span>.sleep(millis, nanos);
        }<span class="keyword">catch</span> (<span class="exception">InterruptedException</span> ex){
            stop();
            <span class="keyword">return</span>;
        }
    }</code></pre></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2017-11-14 05:28:25 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>