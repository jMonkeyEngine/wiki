<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>jMonkeyEngine3 Material Specification</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/jMonkeyEngine/wiki/edit/master/src/docs/asciidoc/jme3/advanced/material_specification.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/jMonkeyEngine/wiki/new/master/src/docs/asciidoc/jme3/advanced/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>jMonkeyEngine3 Material Specification</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div><ul class="sectlevel1"><li><a href="#general-syntax">General Syntax</a></li><li><a href="#material-definition-files-j3md">Material Definition files (J3MD)</a><ul class="sectlevel2"><li><a href="#shaders">Shaders</a></li><li><a href="#syntax-of-a-j3md-file">Syntax of a J3MD file</a></li><li><a href="#techniques">Techniques</a></li><li><a href="#world-global-parameters">World/Global parameters</a></li><li><a href="#renderstate">RenderState</a></li></ul></li><li><a href="#material-instance-files-j3m">Material Instance files (J3M)</a><ul class="sectlevel2"><li><a href="#java-interface-for-j3m">Java interface for J3M</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li></ul></div></div><div id="content"><div class="sect1"><h2 id="general-syntax">General Syntax</h2><div class="sectionbody"><div class="paragraph"><p>Material definitions and material instance files are formatted similarly to curly-bracket languages, in other words, you have “blocks and other “blocks nested in them, surrounded by curly-brackets. There are statements inside the blocks, the next statement begins after a new line, or a semi-colon to allow two statements on the same line. Comments are made by prefixing with two slashes, the <code>/* */</code> style comments are not allowed.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>RootBlock {
  // Comment
  SubBlock NameForTheBlock {
    Statement1 // Another comment
  }
  SubBlock2 {
    SubSubBlock {
      Statement2
      Statement3
      // two statements on the same line
      Statement4; Statement5
    }
  }
  SubBlock3
    { // bracket can be on next line as well
    }
}</code></pre></div></div>
<div class="paragraph"><p>The syntax for J3MD and J3M files follows from this base format.</p></div></div></div>
<div class="sect2"><h3 id="material-definition-files-j3md">Material Definition files (J3MD)</h3><div class="paragraph"><p>Material definitions provide the “logic for the material. Usually a shader that will handle drawing the object, and corresponding parameters that allow configuration of the shader. The J3MD file abstracts the shader and its configuration away from the user, allowing a simple interface where one can simply set a few parameters on the material to change its appearance and the way it&#8217;s handled.</p></div>
<div class="paragraph"><p>Material definitions support multiple techniques, each technique describes a different way to draw the object. For example, currently in jME3, an additional technique is used to render shadow maps for example.</p></div>
<div class="sect2"><h3 id="shaders">Shaders</h3><div class="paragraph"><p>Shader support inside J3MD files is rather sophisticated. First, shaders may reference shader libraries, in a similar way to Java&#8217;s “import statement, or C++'s “include pre-processor directive. Shader libraries in turn, can also reference other shader libraries this way. In the end, it is possible for a shader to use many functions together from many libraries and combine them in ways to create a more advanced effect. For example, any shader that wishes to take advantage of hardware skinning, can just import the skinning shader library and use the function, without having to write the specific logic needed for hardware skinning.</p></div>
<div class="paragraph"><p>Shaders can also take advantage of “defines that are specified inside material definitions.
The defines “bind into material parameters, so that a change in a material parameter can apply or remove a define from the corresponding shader. This allows the shader to completely change in behavior during run-time.</p></div>
<div class="paragraph"><p>Although it is possible to use shader uniforms for the very same purpose, those may introduce slowdowns in older GPUs, that do not support branching. In that case, using defines can allow changing the way the shader works without using shader uniforms. In order to introduce a define into a shader, however, its source code must be changed, and therefore, it must be re-compiled. It is therefore not recommended to change define bound parameters often.</p></div></div>
<div class="sect2"><h3 id="syntax-of-a-j3md-file">Syntax of a J3MD file</h3><div class="paragraph"><p>All J3MD files begin with <code>MaterialDef</code> as the root block, following that, is the name of the material def (in this example <code>Test Material 123</code>). The name is not used for anything important currently, except for debugging. The name is typed as is without quotes, and can have spaces.</p></div>
<div class="paragraph"><p><strong>Example of a first line of a J3MD file:</strong></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>MaterialDef Test Material 123 {</code></pre></div></div>
<div class="paragraph"><p>Inside a MaterialDef block, there can be at most one MaterialParameters block, and one or more <code>Technique</code> blocks.</p></div>
<div class="paragraph"><p>Techniques may have an optional name, which specifies the name of the technique. If no name is specified for a technique, then its name is “Default, and it is used by default if the user does not specify another technique to use for the material.</p></div>
<div class="paragraph"><p><strong>Example of J3MD:</strong></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>MaterialDef Test Material 123 {
  MaterialParameters { }
  Technique { }
  Technique NamedTech { }
}</code></pre></div></div>
<div class="paragraph"><p>Inside the MaterialParameters block, the parameters are specified. Every parameter has a type and a name. Material parameters are similar to Java variables in that aspect.</p></div>
<div class="paragraph"><p><strong>Example of a MaterialParameters block:</strong></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>MaterialParameters {
    Texture2D TexParam
    Color     ColorParam
    Vector3   VectorParam
    Boolean   BoolParam
// ...
}</code></pre></div></div>
<div class="paragraph"><p>Whereas in the J3MD file, the parameter names and types are specified, in a J3M (Material instance) file, the values for these parameters are assigned, as will be shown later. This is how the materials are configured.</p></div>
<div class="paragraph"><p>At the time of writing, the following types of parameters are allowed inside J3MD files: Int, Boolean, Float, Vector2, Vector3, Vector4, Texture2D, TextureCubeMap.</p></div>
<div class="paragraph"><p>You can specify a default value for material parameters, inside material definitions, in the case that no value is specified in the material instance.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>MaterialParameters {
     Float MyParam : 1
// ...
}</code></pre></div></div>
<div class="paragraph"><p>1 will be used as the default value and sent to the shader if it has not been set by a meterial.setFloat() call.</p></div></div>
<div class="sect2"><h3 id="techniques">Techniques</h3><div class="paragraph"><p>Techniques are more advanced blocks than the MaterialParameters block. Techniques may have nested blocks, any many types of statements.</p></div>
<div class="paragraph"><p>In this section, the statements and nested blocks that are allowed inside the Technique block will be described.</p></div>
<div class="paragraph"><p>The two most important statements, are the <code>FragmentShader</code> and <code>VertexShader</code> statements. These statements specify the shader to use for the technique, and are required inside the “Default technique. Both operate in the same way, after the statement, the language of the shader is specified, usually with a version number as well, for example <code>GLSL100</code> for OpenGL Shading Language version 1.00. Followed by a colon and an absolute path for an asset describing the actual shader source code. For GLSL, it is permitted to specify .glsl, .frag, and .vert files.</p></div>
<div class="paragraph"><p>When the material is applied to an object, the shader has its uniforms set based on the material parameter values specified in the material instance. but the parameter is prefixed with an“m_.</p></div>
<div class="paragraph"><p>For example, assuming the parameter <code>Shininess</code> is defined in the MaterialParameters block like so:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>MaterialParameters {
  Float Shininess
}</code></pre></div></div>
<div class="paragraph"><p>The value of that parameter will map into an uniform with same name with the “m_ prefix in the GLSL shader:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>uniform float m_Shininess;</code></pre></div></div>
<div class="paragraph"><p>The letter <code>m</code> in the prefix stands for material.</p></div></div>
<div class="sect2"><h3 id="world-global-parameters">World/Global parameters</h3><div class="paragraph"><p>An important structure, that also relates to shaders, is the WorldParameters structure. It is similar in purpose to the MaterialParameters structure; it exposes various parameters to the shader, but it works differently. Whereas the user specified material parameters, world parameters are specified by the engine. In addition, the WorldParameters structure is nested in the Technique, because it is specific to the shader being used. For example, the Time world parameter specifies the time in seconds since the engine started running, the material can expose this parameter to the shader by specifying it in the WorldParameters structure like so:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>WorldParameters {
  Time
// ...
}</code></pre></div></div>
<div class="paragraph"><p>The shader will be able to access this parameter through a uniform, also named <code>Time</code> but prefixed with <code>g_</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>uniform float g_Time;</code></pre></div></div>
<div class="paragraph"><p>The <code>g</code> letter stands for “global, which is considered a synonym with “world in the context of parameter scope.</p></div>
<div class="paragraph"><p>There are many world parameters available for shaders, a comprehensive list will be specified elsewhere.</p></div></div>
<div class="sect2"><h3 id="renderstate">RenderState</h3><div class="paragraph"><p>The RenderState block specifies values for various render states in the rendering context. The RenderState block is nested inside the Technique block. There are many types of render states, and a comprehensive list will not be included in this document.</p></div>
<div class="paragraph"><p>The most commonly used render state is alpha blending, to specify it for a particular technique, including a RenderState block with the statement <code>Blend Alpha</code>.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>RenderState {
 Blend Alpha
}</code></pre></div></div>
<div class="paragraph"><p><strong>Full Example of a J3MD</strong></p></div>
<div class="paragraph"><p>Included is a full example of a J3MD file using all the features learned:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>MaterialDef Test Material 123 {
  MaterialParameters {
    Float m_Shininess
    Texture2D m_MyTex
  }
  Technique {
    VertexShader GLSL100 : Common/MatDefs/Misc/MyShader.vert
    FragmentShader GLSL100 : Common/MatDefs/Misc/MyShader.frag
    WorldParameters {
      Time
    }
    RenderState {
      Blend Alpha
    }
  }
}</code></pre></div></div></div></div>
<div class="sect2"><h3 id="material-instance-files-j3m">Material Instance files (J3M)</h3><div class="paragraph"><p>In comparison to J3MD files, material instance (J3M) files are significantly simpler. In most cases, the user will not have to modify or create his/her own J3MD files.</p></div>
<div class="paragraph"><p>All J3M files begin with the word <code>Material</code> followed by the name of the material (once again, used for debugging only). Following the name, is a colon and the absolute asset path to the material definition (J3MD) file extended or implemented, followed by a curly-bracket.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>Material MyGrass : Common/MatDefs/Misc/TestMaterial.j3md {</code></pre></div></div>
<div class="paragraph"><p>The material definition is a required component, depending on the material definition being used, the appearance and functionality of the material changes completely. Whereas the material definition provided the “logic for the material, the material instance provides the configuration for how this logic operates.</p></div>
<div class="paragraph"><p>The J3M file includes only a single structure; MaterialParameters, analogous to the same-named structure in the J3MD file. Whereas the J3MD file specified the parameter names and types, the J3M file specifies the values for these parameters. By changing the parameters, the configuration of the parent J3MD changes, allowing a different effect to be achieved.</p></div>
<div class="paragraph"><p>To specify a value for a parameter, one must specify first the parameter name, followed by a colon, and then followed by the parameter value. For texture parameters, the value is an absolute asset path pointing to the image file. Optionally, the path can be prefixed with the word “Flip in order to flip the image along the Y-axis, this may be needed for some models.</p></div>
<div class="paragraph"><p><strong>Example of a MaterialParameters block in J3M:</strong></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>MaterialParameters {
  m_Shininess : 20.0
}</code></pre></div></div>
<table class="tableblock frame-all grid-all spread"><colgroup><col style="width: 50%;"><col style="width: 50%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Param type</th><th class="tableblock halign-left valign-top">Value example</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Int</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>123</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Boolean</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>true</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Float</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>0.1</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Vector2</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>0.1 5.6</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Vector3</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>0.1 5.6 2.99</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Vector4=Color</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>0.1 5.6 2.99 3</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Texture2D=TextureCubeMap</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Textures/MyTex.jpg</p></div></div></td></tr></tbody></table>
<div class="paragraph"><p>The formatting of the value, depends on the type of the value that was specified in the J3MD file being extended. Examples are provided for every parameter type:</p></div>
<div class="paragraph"><p><strong>Full example of a J3M</strong></p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code>Material MyGrass : Common/MatDefs/Misc/TestMaterial.j3md {
  MaterialParameters {
    m_MyTex : Flip Textures/GrassTex.jpg
    m_Shininess : 20.0
  }
}</code></pre></div></div>
<div class="sect2"><h3 id="java-interface-for-j3m">Java interface for J3M</h3><div class="paragraph"><p>It is possible to generate an identical J3M file using Java code, by using the classes in the com.jme3.material package. Specifics of the <a href="http://javadoc.jmonkeyengine.org/com/jme3/material/Material.html">Material API</a> will not be provided in this document. The J3M file above is represented by this Java code:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create a material instance</span>
Material mat = <span class="keyword">new</span> Material(assetManager, <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/
    TestMaterial.j3md</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// Load the texture. Specify &quot;true&quot; for the flip flag in the TextureKey</span>
Texture tex =
assetManager.loadTexture(<span class="keyword">new</span> TextureKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/GrassTex.jpg</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>));
<span class="comment">// Set the parameters</span>
mat.setTexture(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyTex</span><span class="delimiter">&quot;</span></span>, tex);
mat.setFloat(<span class="string"><span class="delimiter">&quot;</span><span class="content">Shininess</span><span class="delimiter">&quot;</span></span>, <span class="float">20.0f</span>);</code></pre></div></div></div></div>
<div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>Congratulations on being able to read this entire document! To reward your efforts, jMonkeyEngine.com will offer a free prize, please contact Momoko_Fan aka “Kirill Vainer with the password “bananapie to claim.</p></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2017-11-14 05:28:25 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>