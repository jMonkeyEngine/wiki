<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>hellochasecam</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/jMonkeyEngine/wiki/edit/master/src/docs/asciidoc/jme3/beginner/hellochasecam.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/jMonkeyEngine/wiki/new/master/src/docs/asciidoc/jme3/beginner/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>hellochasecam</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Table of Contents</div></div></div><div id="content"><div class="paragraph"><p><a href="http://www.youtube.com/watch?v=dXGfecvI1Sk">Youtube video</a></p></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/beginner/chasecamera.png" alt="chasecamera.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p><a href="https://code.google.com/p/jmonkeyengine/source/browse/#svn%2Ftrunk%2Fengine%2Ftest-data%2FModels%2FNinja">Ninja Mesh</a></p></li><li><p><a href="http://jmonkeyengine.googlecode.com/svn/trunk/engine/town.zip">Town Scene</a></p></li><li><p>Walk Bugs emoji:</p></li><li><p>Jump Bugs emoji:</p></li></ul></div>
<div class="paragraph"><p>Memo:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>jMonkeyEngine calls the update() methods of all AppState objects in the order in which you attached them.</p></li><li><p>jMonkeyEngine calls the controlUpdate() methods of all controls in the order in which you added them.</p></li><li><p>jMonkeyEngine calls the simpleUpdate() method of the main SimpleApplication class.</p></li></ol></div>
<div class="paragraph"><p>—AbstractPhysicBodyContext</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.state.AbstractAppState</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.BulletAppState</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">AbstractPhysicBodyContext</span> <span class="directive">extends</span> AbstractAppState
{

    <span class="directive">private</span> AppStateManager stateManager = <span class="predefined-constant">null</span>;
    <span class="comment">//</span>
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> BulletAppState bulletAppState;

    <span class="directive">static</span>
    {
        bulletAppState = <span class="keyword">new</span> BulletAppState();
    }

    <span class="directive">public</span> AbstractPhysicBodyContext()
    {
    }

    <span class="comment">/**
     @return the bulletAppState
     */</span>
    <span class="directive">public</span> BulletAppState getBulletAppState()
    {
        <span class="keyword">return</span> bulletAppState;
    }

    <span class="comment">/**
     @param stateManager the stateManager to set
     Attaching BulletAppstate to Initialize PhysicsSpace
     */</span>
    <span class="directive">public</span> <span class="type">void</span> attachBulletAppstate(AppStateManager stateManager)
    {
        <span class="local-variable">this</span>.stateManager = stateManager;
        stateManager.attach(bulletAppState);
    }
}</code></pre></div></div>
<div class="paragraph"><p>—AbstractSpatialBodyContext.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.state.AbstractAppState</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">AbstractSpatialBodyContext</span> <span class="directive">extends</span> AbstractAppState
{

    <span class="directive">public</span> AbstractSpatialBodyContext()
    {
    }

}</code></pre></div></div>
<div class="paragraph"><p>—ApplicationContext.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AbstractAppState</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.asset.AssetManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.FlyByCamera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.InputManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.ColorRGBA</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.Camera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">com.jme3.system.AppSettings</span>;
<span class="keyword">import</span> <span class="include">org.jmonkey.utils.Debug</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationContext</span> <span class="directive">extends</span> AbstractAppState
{

    <span class="directive">private</span> <span class="directive">final</span> Node rootNode;
<span class="comment">//</span>
    <span class="directive">private</span> <span class="directive">final</span> CameraContext sceneCameraContext;
    <span class="directive">private</span> <span class="directive">final</span> AvatarBodyManager avatarBodyManager;
    <span class="directive">private</span> <span class="directive">final</span> SceneBodyManager sceneBodyManager;

<span class="comment">/**

    @param stateManager
    @param am
    @param settings
    @param inputManager
    @param rootNode
    @param cam
    @param flyByCam
    */</span>
    <span class="directive">public</span> ApplicationContext(AppStateManager stateManager, AssetManager am, AppSettings settings, InputManager inputManager, Node rootNode, Camera cam, FlyByCamera flyByCam)
    {

        <span class="local-variable">this</span>.rootNode = rootNode;
        <span class="local-variable">this</span>.sceneCameraContext = <span class="keyword">new</span> CameraContext(settings, inputManager, cam, flyByCam);
        <span class="local-variable">this</span>.sceneBodyManager = <span class="keyword">new</span> SceneBodyManager(stateManager, am, rootNode);
        <span class="local-variable">this</span>.avatarBodyManager = <span class="keyword">new</span> AvatarBodyManager(am, rootNode, sceneCameraContext);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {
        <span class="comment">//super.initialize(stateManager, app);</span>
        <span class="comment">//TODO: initialize your AppState, e.g. attach spatials to rootNode</span>
        <span class="comment">//this is called on the OpenGL thread after the AppState has been attached</span>

<span class="comment">//</span>
        stateManager.attach(<span class="local-variable">this</span>.sceneCameraContext);
        stateManager.attach(<span class="local-variable">this</span>.sceneBodyManager);<span class="comment">//initialize physic spacein constructor</span>
        stateManager.attach(<span class="local-variable">this</span>.avatarBodyManager);
        <span class="comment">//</span>
        Debug.showNodeAxes(app.getAssetManager(), <span class="local-variable">this</span>.rootNode, <span class="float">1024.0f</span>);
        Debug.attachWireFrameDebugGrid(app.getAssetManager(), rootNode, Vector3f.ZERO, <span class="integer">2048</span>, ColorRGBA.DarkGray);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> update(<span class="type">float</span> tpf)
    {

    }
}</code></pre></div></div>
<div class="paragraph"><p>—AvatarAnimationEventListener.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimChannel</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimEventListener</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AbstractAppState</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.objects.PhysicsCharacter</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AvatarAnimationEventListener</span> <span class="directive">extends</span> AbstractAppState <span class="directive">implements</span> AnimEventListener
{

    <span class="directive">private</span> <span class="directive">final</span> AnimChannel channel;
    <span class="directive">private</span> <span class="directive">final</span> AnimControl control;
    <span class="directive">private</span> <span class="directive">final</span> PlayerInputActionListener pial;
    <span class="directive">private</span> <span class="directive">final</span> AvatarAnimationHelper animHelper;
    <span class="directive">private</span> <span class="directive">final</span> PhysicsCharacter physicBody;
<span class="comment">/**

    @param pial
    @param pc
    @param avatarMesh
    */</span>
    <span class="directive">public</span> AvatarAnimationEventListener(PlayerInputActionListener pial, PhysicsCharacter pc, Spatial avatarMesh)
    {
        <span class="local-variable">this</span>.pial = pial;
        <span class="local-variable">this</span>.control = avatarMesh.getControl(AnimControl.class);
        <span class="keyword">assert</span> (<span class="local-variable">this</span>.control != <span class="predefined-constant">null</span>);
        <span class="local-variable">this</span>.channel = <span class="local-variable">this</span>.control.createChannel();
        <span class="local-variable">this</span>.physicBody = pc;
        <span class="local-variable">this</span>.animHelper = <span class="keyword">new</span> AvatarAnimationHelper(<span class="local-variable">this</span>.physicBody, <span class="local-variable">this</span>.channel);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {
        <span class="local-variable">this</span>.control.addListener(<span class="local-variable">this</span>);
        <span class="local-variable">this</span>.channel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle1</span><span class="delimiter">&quot;</span></span>);
        <span class="local-variable">this</span>.channel.setSpeed(<span class="float">0.5f</span>);
    }

    <span class="directive">public</span> <span class="type">void</span> onAnimCycleDone(AnimControl control, AnimChannel channel, <span class="predefined-type">String</span> animName)
    {
        <span class="comment">//throw new UnsupportedOperationException(&quot;Not supported yet.&quot;); //To change body of generated methods, choose Tools | Templates.</span>
    }

    <span class="directive">public</span> <span class="type">void</span> onAnimChange(AnimControl control, AnimChannel channel, <span class="predefined-type">String</span> animName)
    {
        <span class="comment">//throw new UnsupportedOperationException(&quot;Not supported yet.&quot;); //To change body of generated methods, choose Tools | Templates.</span>

    }

    <span class="comment">/**
     @return the channel
     */</span>
    <span class="directive">protected</span> AnimChannel getChannel()
    {
        <span class="keyword">return</span> channel;
    }

    <span class="comment">/**
     @return the control
     */</span>
    <span class="directive">protected</span> AnimControl getControl()
    {
        <span class="keyword">return</span> control;
    }

    <span class="comment">/**
     * @return the animHelper
     */</span>
    <span class="directive">protected</span> AvatarAnimationHelper getAnimHelper()
    {
        <span class="keyword">return</span> animHelper;
    }
}</code></pre></div></div>
<div class="paragraph"><p>—AvatarAnimationHelper.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimChannel</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.LoopMode</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.objects.PhysicsCharacter</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AvatarAnimationHelper</span>
{

    <span class="directive">private</span> <span class="directive">final</span> AnimChannel animChannel;
    <span class="directive">private</span> <span class="directive">final</span> PhysicsCharacter physicBody;
<span class="comment">/**

    @param pc
    @param ac
    */</span>
    <span class="directive">public</span> AvatarAnimationHelper(PhysicsCharacter pc, AnimChannel ac)
    {
        <span class="local-variable">this</span>.animChannel = ac;
        <span class="local-variable">this</span>.physicBody = pc;
    }

    <span class="directive">protected</span> <span class="type">void</span> idle()
    {
        animChannel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">Idle1</span><span class="delimiter">&quot;</span></span>);
        animChannel.setSpeed(<span class="float">0.5f</span>);
    }

    <span class="directive">protected</span> <span class="type">boolean</span> forward(<span class="type">boolean</span> pressed)
    {
        <span class="keyword">if</span> (pressed)
        {
            <span class="keyword">if</span> (<span class="local-variable">this</span>.physicBody.onGround())
            {
                animChannel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>);
                animChannel.setSpeed(AvatarConstants.FORWARD_MOVE_SPEED * <span class="float">2f</span>);
                animChannel.setLoopMode(LoopMode.Loop);
            }
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        } <span class="keyword">else</span>
        {
            idle();
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
        <span class="comment">//throw new UnsupportedOperationException(&quot;Not supported yet.&quot;); //To change body of generated methods, choose Tools | Templates.</span>
    }

    <span class="directive">protected</span> <span class="type">boolean</span> backward(<span class="type">boolean</span> pressed)
    {
        <span class="keyword">if</span> (pressed)
        {
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        } <span class="keyword">else</span>
        {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
    }

    <span class="directive">protected</span> <span class="type">boolean</span> rightward(<span class="type">boolean</span> pressed)
    {
        <span class="keyword">if</span> (pressed)
        {
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        } <span class="keyword">else</span>
        {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
    }

    <span class="directive">protected</span> <span class="type">boolean</span> leftward(<span class="type">boolean</span> pressed)
    {
        <span class="keyword">if</span> (pressed)
        {
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        } <span class="keyword">else</span>
        {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
    }

    <span class="directive">protected</span> <span class="type">boolean</span> jump(<span class="type">boolean</span> pressed)
    {
            <span class="keyword">if</span> (pressed)
            {
                <span class="keyword">if</span> (<span class="local-variable">this</span>.physicBody.onGround())
                {
                    animChannel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">HighJump</span><span class="delimiter">&quot;</span></span>);
                    animChannel.setSpeed(AvatarConstants.FORWARD_MOVE_SPEED / <span class="float">1.8f</span>);
                    animChannel.setLoopMode(LoopMode.DontLoop);
                    <span class="comment">//</span>
                    <span class="local-variable">this</span>.physicBody.jump();
                }
                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
            } <span class="keyword">else</span>
            {
                <span class="keyword">return</span> <span class="predefined-constant">false</span>;
            }
    }
}</code></pre></div></div>
<div class="paragraph"><p>—AvatarBodyManager.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.asset.AssetManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.control.BetterCharacterControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.objects.PhysicsCharacter</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.ChaseCamera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.InputManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.Camera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">org.jmonkey.utils.Debug</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AvatarBodyManager</span> <span class="directive">extends</span> AbstractPhysicBodyContext
{

    <span class="directive">private</span> InputManager inputManager;
    <span class="directive">private</span> <span class="directive">final</span> Node rootNode;
    <span class="comment">//</span>
    <span class="directive">private</span> <span class="directive">final</span> CameraContext cc;
    <span class="directive">private</span> <span class="directive">final</span> Camera cam;
    <span class="directive">private</span> <span class="directive">final</span> ChaseCamera chaseCam;
    <span class="comment">//</span>
    <span class="directive">private</span> <span class="directive">final</span> AvatarPhysicBodyContext apbc;
    <span class="directive">private</span> <span class="directive">final</span> AvatarSpatialBodyContext asbc;
    <span class="comment">//</span>
    <span class="directive">private</span> <span class="directive">final</span> PhysicsCharacter physicBody;
    <span class="directive">private</span> <span class="directive">final</span> Node avatar;
    <span class="directive">private</span> <span class="directive">final</span> BetterCharacterControl bcc;
    <span class="comment">//</span>

    <span class="directive">private</span> <span class="directive">final</span> PlayerInputActionListener playerInputListener;

<span class="comment">/**

    @param am
    @param rootNode
    @param cc
    */</span>
    <span class="directive">public</span> AvatarBodyManager(AssetManager am, Node rootNode, CameraContext cc)
    {

        <span class="comment">//</span>
        <span class="local-variable">this</span>.rootNode = rootNode;
        <span class="comment">//</span>
        <span class="local-variable">this</span>.asbc = <span class="keyword">new</span> AvatarSpatialBodyContext(am, rootNode);
        <span class="local-variable">this</span>.apbc = <span class="keyword">new</span> AvatarPhysicBodyContext();
        <span class="comment">//</span>
        <span class="local-variable">this</span>.physicBody = apbc.getPhysicBody();

        <span class="local-variable">this</span>.avatar = asbc.getAvatar();
        <span class="local-variable">this</span>.bcc = <span class="keyword">new</span> BetterCharacterControl(AvatarConstants.COLLISION_SHAPE_RADIUS, AvatarConstants.COLLISION_SHAPE_RADIUS * <span class="integer">2</span>, AvatarConstants.PHYSIC_BODY_MASS);
        <span class="comment">//</span>
        <span class="local-variable">this</span>.playerInputListener = <span class="keyword">new</span> PlayerInputActionListener(<span class="local-variable">this</span>.physicBody, <span class="local-variable">this</span>.asbc.getAvatarMesh());
        <span class="comment">//</span>
        <span class="local-variable">this</span>.cc = cc;
        <span class="local-variable">this</span>.cam = cc.getCam();
        <span class="local-variable">this</span>.chaseCam = cc.getChaseCam();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {
        <span class="comment">//TODO: initialize your AppState, e.g. attach spatials to rootNode</span>
        <span class="comment">//this is called on the OpenGL thread after the AppState has been attached</span>

        stateManager.attach(<span class="local-variable">this</span>.asbc);
        stateManager.attach(<span class="local-variable">this</span>.apbc);
        stateManager.attach(<span class="local-variable">this</span>.playerInputListener);


<span class="comment">//</span>
        <span class="local-variable">this</span>.avatar.addControl(<span class="keyword">new</span> AvatarBodyMoveControl(playerInputListener, physicBody, cam));
        <span class="local-variable">this</span>.avatar.addControl(chaseCam);
        <span class="local-variable">this</span>.avatar.addControl(bcc);

        <span class="comment">//DEBUG</span>
        Debug.showNodeAxes(app.getAssetManager(), avatar, <span class="integer">4</span>);
        getBulletAppState().getPhysicsSpace().enableDebug(app.getAssetManager());
    }



    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> update(<span class="type">float</span> tpf)
    {
        <span class="comment">//assert (sceneCameraContext != null);</span>

        <span class="comment">//correctDirectionVectors(cam.getDirection(), cam.getLeft());</span>

    }
}</code></pre></div></div>
<div class="paragraph"><p>—AvatarBodyMoveControl.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.bullet.control.BetterCharacterControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.objects.PhysicsCharacter</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.Camera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.RenderManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.ViewPort</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.AbstractControl</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AvatarBodyMoveControl</span> <span class="directive">extends</span> AbstractControl
{
    <span class="directive">private</span> <span class="directive">final</span> Camera cam;
    <span class="directive">private</span> <span class="directive">final</span> PhysicsCharacter physicBody;
    <span class="directive">private</span> <span class="directive">final</span> PlayerInputActionListener pial;
<span class="comment">/**

    @param pial
    @param physicBody
    @param cam
    */</span>
    <span class="directive">public</span> AvatarBodyMoveControl(PlayerInputActionListener pial, PhysicsCharacter physicBody, Camera cam)
    {
        <span class="local-variable">this</span>.pial = pial;
        <span class="local-variable">this</span>.physicBody = physicBody;
        <span class="local-variable">this</span>.cam = cam;
    }
    <span class="directive">private</span> <span class="directive">final</span> Vector3f walkDirection = <span class="keyword">new</span> Vector3f();

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> controlUpdate(<span class="type">float</span> tpf)
    {
        <span class="comment">//throw new UnsupportedOperationException(&quot;Not supported yet.&quot;); //To change body of generated methods, choose Tools | Templates.</span>
        correctDirectionVectors();
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> controlRender(RenderManager rm, ViewPort vp)
    {
        <span class="comment">//throw new UnsupportedOperationException(&quot;Not supported yet.&quot;); //To change body of generated methods, choose Tools | Templates.</span>
    }


        <span class="comment">/**

     @param camDir
     @param camLeft
     */</span>
    <span class="directive">public</span> <span class="type">void</span> correctDirectionVectors()
    {
<span class="comment">//        assert (camDir != null);</span>
<span class="comment">//        assert (camLeft != null);</span>
<span class="comment">//        assert (walkDirection != null);</span>
        <span class="comment">//Affect forward, backward move speed 0.6f lower - 1.0f faster</span>
        Vector3f camDirVector = cam.getDirection().clone().multLocal(AvatarConstants.FORWARD_MOVE_SPEED);
        <span class="comment">//Affect left, right move speed 0.6f lower - 1.0f faster</span>
        Vector3f camLeftVector = cam.getLeft().clone().multLocal(AvatarConstants.SIDEWARD_MOVE_SPEED);

        walkDirection.set(<span class="integer">0</span>, <span class="integer">0</span>, <span class="integer">0</span>);<span class="comment">//critical</span>
        <span class="keyword">if</span> (pial.isLeftward())
        {
            walkDirection.addLocal(camLeftVector);
        }
        <span class="keyword">if</span> (pial.isRightward())
        {
            walkDirection.addLocal(camLeftVector.negate());
        }
        <span class="keyword">if</span> (pial.isForward())
        {
            walkDirection.addLocal(camDirVector);
        }
        <span class="keyword">if</span> (pial.isBackward())
        {
            <span class="comment">//@TODO Bug if cam direction (0, -n, 0) - character fly upwards ;)</span>
            walkDirection.addLocal(camDirVector.negate());
        }
        physicBody.setWalkDirection(walkDirection);<span class="comment">//Critical</span>



        <span class="comment">//Avoid vibration</span>
        spatial.setLocalTranslation(physicBody.getPhysicsLocation());
        <span class="comment">//Translate Node accordingly</span>
        spatial.getControl(BetterCharacterControl.class).warp(physicBody.getPhysicsLocation());
        <span class="comment">//Rotate Node accordingly to camera</span>
        spatial.getControl(
                BetterCharacterControl.class).setViewDirection(
                cam.getDirection().negate());

    }
}</code></pre></div></div>
<div class="paragraph"><p>—AvatarConstants.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AvatarConstants</span>
{
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">float</span> COLLISION_SHAPE_CENTERAL_POINT = <span class="float">0.0f</span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">float</span> COLLISION_SHAPE_RADIUS = <span class="float">4.0f</span>;
    <span class="comment">//</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">float</span> PHYSIC_BODY_MASS = <span class="float">1.0f</span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">float</span> FORWARD_MOVE_SPEED = <span class="float">0.8f</span>;
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">float</span> SIDEWARD_MOVE_SPEED = <span class="float">0.6f</span>;
}</code></pre></div></div>
<div class="paragraph"><p>—AvatarPhysicBodyContext.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.collision.shapes.SphereCollisionShape</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.objects.PhysicsCharacter</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AvatarPhysicBodyContext</span> <span class="directive">extends</span> AbstractPhysicBodyContext
{



    <span class="directive">private</span> <span class="directive">final</span> PhysicsCharacter physicBody;


    <span class="directive">public</span> AvatarPhysicBodyContext()
    {

        <span class="local-variable">this</span>.physicBody = <span class="keyword">new</span> PhysicsCharacter(<span class="keyword">new</span> SphereCollisionShape(AvatarConstants.COLLISION_SHAPE_RADIUS), <span class="float">.01f</span>);

    }



    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {
<span class="comment">//</span>
        <span class="keyword">assert</span> (getBulletAppState() != <span class="predefined-constant">null</span>);
        <span class="predefined-type">System</span>.out.println(<span class="local-variable">this</span>.getClass().getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">.getBulletAppState().hashCode() = </span><span class="delimiter">&quot;</span></span> + getBulletAppState().hashCode());

<span class="comment">//</span>
        <span class="local-variable">this</span>.physicBody.setJumpSpeed(<span class="integer">32</span>);
        <span class="local-variable">this</span>.physicBody.setFallSpeed(<span class="integer">32</span>);
        <span class="local-variable">this</span>.physicBody.setGravity(<span class="integer">32</span>);
        <span class="local-variable">this</span>.physicBody.setPhysicsLocation(<span class="keyword">new</span> Vector3f(<span class="integer">0</span>, <span class="integer">10</span>, <span class="integer">0</span>));
        <span class="comment">//</span>
        getBulletAppState().getPhysicsSpace().add(<span class="local-variable">this</span>.physicBody);

    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> update(<span class="type">float</span> tpf)
    {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> cleanup()
    {
        <span class="local-variable">super</span>.cleanup();
    }

    <span class="comment">/**
     @return the physicBody
     */</span>
    <span class="directive">public</span> PhysicsCharacter getPhysicBody()
    {
        <span class="keyword">return</span> <span class="local-variable">this</span>.physicBody;
    }
}</code></pre></div></div>
<div class="paragraph"><p>—AvatarSpatialBodyContext.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.asset.AssetManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AvatarSpatialBodyContext</span> <span class="directive">extends</span> AbstractSpatialBodyContext
{

    <span class="comment">//</span>
    <span class="directive">private</span> <span class="directive">final</span> Node rootNode;
    <span class="comment">//</span>
    <span class="directive">private</span> <span class="directive">final</span> Node avatar;
    <span class="directive">private</span> <span class="directive">final</span> Spatial avatarMesh;
    <span class="directive">private</span> <span class="directive">final</span> Vector3f correction;
<span class="comment">/**

    @param am
    @param rootNode
    */</span>
    <span class="directive">public</span> AvatarSpatialBodyContext(AssetManager am, Node rootNode)
    {
        <span class="local-variable">this</span>.rootNode = rootNode;
        <span class="comment">//</span>
        <span class="local-variable">this</span>.avatar = <span class="keyword">new</span> Node();
        <span class="local-variable">this</span>.avatarMesh = am.loadModel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Models/Ninja/Ninja.mesh.xml</span><span class="delimiter">&quot;</span></span>);
        <span class="local-variable">this</span>.correction = <span class="keyword">new</span> Vector3f(
                <span class="integer">0</span>,
                AvatarConstants.COLLISION_SHAPE_CENTERAL_POINT - AvatarConstants.COLLISION_SHAPE_RADIUS,
                <span class="integer">0</span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {


        <span class="local-variable">this</span>.avatarMesh.setLocalScale(<span class="keyword">new</span> Vector3f(<span class="float">0.05f</span>, <span class="float">0.05f</span>, <span class="float">0.05f</span>));<span class="comment">//Trouble with scales?</span>
        <span class="local-variable">this</span>.avatarMesh.setLocalTranslation(<span class="local-variable">this</span>.correction);
        <span class="local-variable">this</span>.avatar.attachChild(<span class="local-variable">this</span>.avatarMesh);
        <span class="local-variable">this</span>.rootNode.attachChild(<span class="local-variable">this</span>.avatar);

        <span class="comment">//super.initialize(stateManager, app); //To change body of generated methods, choose Tools | Templates.</span>
    }

    <span class="comment">/**
     @return the avatar
     */</span>
    <span class="directive">public</span> Node getAvatar()
    {
        <span class="keyword">return</span> avatar;
    }

    <span class="comment">/**
     * @return the avatarMesh
     */</span>
    <span class="directive">public</span> Spatial getAvatarMesh()
    {
        <span class="keyword">return</span> avatarMesh;
    }
}</code></pre></div></div>
<div class="paragraph"><p>—CameraContext.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AbstractAppState</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.ChaseCamera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.FlyByCamera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.InputManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.Camera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.system.AppSettings</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CameraContext</span> <span class="directive">extends</span> AbstractAppState
{

    <span class="directive">private</span> <span class="directive">final</span> AppSettings settings;
    <span class="directive">private</span> <span class="directive">final</span> InputManager inputManager;
    <span class="comment">/*
     http://hub.jmonkeyengine.org/javadoc/com/jme3/renderer/Camera.html
     public class Camera
     extends java.lang.Object
     implements Savable, java.lang.Cloneable

     Width and height are set to the current Application's settings.getWidth() and settings.getHeight() values.
     Frustum Perspective:
     Frame of view angle of 45Â° along the Y axis
     Aspect ratio of width divided by height
     Near view plane of 1 wu
     Far view plane of 1000 wu
     Start location at (0f, 0f, 10f).
     Start direction is looking at the origin.
     */</span>
    <span class="directive">private</span> <span class="directive">final</span> Camera cam;
    <span class="comment">/*
     http://hub.jmonkeyengine.org/javadoc/com/jme3/input/ChaseCamera.html
     public class ChaseCamera
     extends java.lang.Object
     implements ActionListener, AnalogListener, Control

     A camera that follows a spatial and can turn around it by dragging the mouse
     Constructs the chase camera, and registers inputs if you use this
     constructor you have to attach the cam later to a spatial doing
     spatial.addControl(chaseCamera);
     */</span>
    <span class="directive">private</span> <span class="directive">final</span> ChaseCamera chaseCam;
    <span class="directive">private</span> <span class="directive">final</span> FlyByCamera flyByCam;

<span class="comment">/**

    @param settings
    @param inputManager
    @param cam
    @param flyByCam
    */</span>
    <span class="directive">public</span> CameraContext(AppSettings settings, InputManager inputManager, Camera cam, FlyByCamera flyByCam)
    {

        <span class="keyword">assert</span> (settings != <span class="predefined-constant">null</span>);
        <span class="local-variable">this</span>.settings = settings;
        <span class="keyword">assert</span> (inputManager != <span class="predefined-constant">null</span>);
        <span class="local-variable">this</span>.inputManager = inputManager;
        <span class="keyword">assert</span> (cam != <span class="predefined-constant">null</span>);
        <span class="local-variable">this</span>.cam = cam;
        <span class="keyword">assert</span> (flyByCam != <span class="predefined-constant">null</span>);
        <span class="local-variable">this</span>.flyByCam = flyByCam;
        <span class="local-variable">this</span>.chaseCam = <span class="keyword">new</span> ChaseCamera(<span class="local-variable">this</span>.cam, <span class="local-variable">this</span>.inputManager);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {
        <span class="local-variable">super</span>.initialize(stateManager, app);
        <span class="comment">//TODO: initialize your AppState, e.g. attach spatials to rootNode</span>
        <span class="comment">//this is called on the OpenGL thread after the AppState has been attached</span>

        <span class="local-variable">this</span>.cam.setFrustumPerspective(<span class="float">116.0f</span>, (settings.getWidth() / settings.getHeight()), <span class="float">1.0f</span>, <span class="float">2000.0f</span>);
        <span class="comment">//this.flyByCam.setMoveSpeed(100);</span>
        <span class="local-variable">this</span>.flyByCam.setEnabled(<span class="predefined-constant">false</span>);
    }

    <span class="comment">/**
     @return the cam
     */</span>
    <span class="directive">public</span> Camera getCam()
    {
        <span class="keyword">return</span> cam;
    }

    <span class="comment">/**
     @return the chaseCam
     */</span>
    <span class="directive">public</span> ChaseCamera getChaseCam()
    {
        <span class="keyword">return</span> chaseCam;
    }
}</code></pre></div></div>
<div class="paragraph"><p>—PlayerInputActionListener.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AbstractAppState</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.objects.PhysicsCharacter</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.KeyInput</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.controls.ActionListener</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.controls.KeyTrigger</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PlayerInputActionListener</span> <span class="directive">extends</span> AbstractAppState <span class="directive">implements</span> <span class="predefined-type">ActionListener</span>
{

    <span class="directive">private</span> <span class="directive">final</span> PhysicsCharacter physicBody;
<span class="comment">//</span>
    <span class="directive">private</span> <span class="type">boolean</span> leftward = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="type">boolean</span> rightward = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="type">boolean</span> forward = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="type">boolean</span> backward = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="type">boolean</span> jump = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="directive">final</span> AvatarAnimationEventListener aael;
<span class="comment">/**

    @param pc
    @param avatar
    */</span>
    <span class="directive">public</span> PlayerInputActionListener(PhysicsCharacter pc, Spatial avatar)
    {
        <span class="local-variable">this</span>.physicBody = pc;
        <span class="local-variable">this</span>.aael = <span class="keyword">new</span> AvatarAnimationEventListener(<span class="local-variable">this</span>, <span class="local-variable">this</span>.physicBody, avatar);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {
        stateManager.attach(<span class="local-variable">this</span>.aael);
        <span class="comment">//</span>
        app.getInputManager().addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">LEFTWARD</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_A));
        app.getInputManager().addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">RIGHTWARD</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_D));
        app.getInputManager().addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">FORWARD</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_W));
        app.getInputManager().addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">BACKWARD</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_S));
        app.getInputManager().addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">JUMP</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_SPACE));
        app.getInputManager().addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">LEFTWARD</span><span class="delimiter">&quot;</span></span>);
        app.getInputManager().addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">RIGHTWARD</span><span class="delimiter">&quot;</span></span>);
        app.getInputManager().addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">FORWARD</span><span class="delimiter">&quot;</span></span>);
        app.getInputManager().addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">BACKWARD</span><span class="delimiter">&quot;</span></span>);
        app.getInputManager().addListener(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">JUMP</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">//</span>
    }

    <span class="comment">/**
     @param binding
     @param keyPressed
     @param tpf
     */</span>
    <span class="directive">public</span> <span class="type">void</span> onAction(<span class="predefined-type">String</span> binding, <span class="type">boolean</span> keyPressed, <span class="type">float</span> tpf)
    {

        <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">LEFTWARD</span><span class="delimiter">&quot;</span></span>))
        {

            <span class="local-variable">this</span>.leftward = <span class="local-variable">this</span>.aael.getAnimHelper().leftward(keyPressed);

        } <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">RIGHTWARD</span><span class="delimiter">&quot;</span></span>))
        {

            <span class="local-variable">this</span>.rightward = <span class="local-variable">this</span>.aael.getAnimHelper().rightward(keyPressed);

        } <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">FORWARD</span><span class="delimiter">&quot;</span></span>))
        {

            <span class="local-variable">this</span>.forward = <span class="local-variable">this</span>.aael.getAnimHelper().forward(keyPressed);

        } <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">BACKWARD</span><span class="delimiter">&quot;</span></span>))
        {

                <span class="local-variable">this</span>.backward = <span class="local-variable">this</span>.aael.getAnimHelper().backward(keyPressed);

        } <span class="keyword">else</span> <span class="keyword">if</span> (binding.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">JUMP</span><span class="delimiter">&quot;</span></span>))
        {

            <span class="local-variable">this</span>.jump = <span class="local-variable">this</span>.aael.getAnimHelper().jump(keyPressed);

        }
    }

    <span class="comment">/**
     @return the leftward
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> isLeftward()
    {
        <span class="keyword">return</span> <span class="local-variable">this</span>.leftward;
    }

    <span class="comment">/**
     @return the rightward
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> isRightward()
    {
        <span class="keyword">return</span> <span class="local-variable">this</span>.rightward;
    }

    <span class="comment">/**
     @return the forward
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> isForward()
    {
        <span class="keyword">return</span> <span class="local-variable">this</span>.forward;
    }

    <span class="comment">/**
     @return the backward
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> isBackward()
    {
        <span class="keyword">return</span> <span class="local-variable">this</span>.backward;
    }

    <span class="comment">/**
     @return the jump
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> isJump()
    {
        <span class="keyword">return</span> <span class="local-variable">this</span>.jump;
    }
}</code></pre></div></div>
<div class="paragraph"><p>—SceneBodyManager.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.asset.AssetManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SceneBodyManager</span> <span class="directive">extends</span> AbstractPhysicBodyContext
{

    <span class="directive">private</span> <span class="directive">final</span> ScenePhysicBodyContext spbc;
    <span class="directive">private</span> <span class="directive">final</span> SceneSpatialBodyContext ssbc;

<span class="comment">/**

    @param stateManager
    @param am
    @param rootNode
    */</span>
    <span class="directive">public</span> SceneBodyManager(AppStateManager stateManager, AssetManager am, Node rootNode)
    {


        <span class="local-variable">this</span>.ssbc = <span class="keyword">new</span> SceneSpatialBodyContext(am, rootNode);
        <span class="local-variable">this</span>.spbc = <span class="keyword">new</span> ScenePhysicBodyContext(ssbc.getScene());
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {

        <span class="comment">//PhysicsSpace Initialization</span>
        attachBulletAppstate(stateManager);
<span class="comment">//</span>
        stateManager.attach(<span class="local-variable">this</span>.ssbc);
        stateManager.attach(<span class="local-variable">this</span>.spbc);

    }
}</code></pre></div></div>
<div class="paragraph"><p>—ScenePhysicBodyContext.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.bullet.control.RigidBodyControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ScenePhysicBodyContext</span> <span class="directive">extends</span> AbstractPhysicBodyContext
{
    <span class="directive">private</span> <span class="directive">final</span> RigidBodyControl rigidBodyControl;
    <span class="directive">private</span> <span class="directive">final</span> Node scene;

<span class="comment">/**

    @param scene
    */</span>
    <span class="directive">public</span> ScenePhysicBodyContext(Node scene)
    {
        <span class="local-variable">this</span>.scene = scene;
        <span class="local-variable">this</span>.rigidBodyControl = <span class="keyword">new</span> RigidBodyControl(<span class="float">.0f</span>);
    }


    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {
        <span class="comment">//</span>
        <span class="comment">//Add scene to PhysicsSpace</span>
        <span class="predefined-type">System</span>.out.println(<span class="local-variable">this</span>.getClass().getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">.getBulletAppState().hashCode() = </span><span class="delimiter">&quot;</span></span> + getBulletAppState().hashCode());
        scene.addControl(rigidBodyControl);
        getBulletAppState().getPhysicsSpace().addAll(scene);
    }

}</code></pre></div></div>
<div class="paragraph"><p>—SceneSpatialBodyContext.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.Application</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.state.AppStateManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.asset.AssetManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.asset.plugins.ZipLocator</span>;
<span class="keyword">import</span> <span class="include">com.jme3.light.AmbientLight</span>;
<span class="keyword">import</span> <span class="include">com.jme3.light.DirectionalLight</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SceneSpatialBodyContext</span> <span class="directive">extends</span> AbstractSpatialBodyContext
{

    <span class="directive">private</span> <span class="directive">final</span> Node rootNode;
    <span class="comment">//</span>
    <span class="directive">private</span> <span class="directive">final</span> Node scene;
    <span class="directive">private</span> AmbientLight ambient;
    <span class="directive">private</span> DirectionalLight sun;
<span class="comment">/**

    @param am
    @param rootNode
    */</span>
    <span class="directive">public</span> SceneSpatialBodyContext(AssetManager am, Node rootNode)
    {
        <span class="local-variable">this</span>.rootNode = rootNode;
        <span class="comment">//</span>
        am.registerLocator(<span class="string"><span class="delimiter">&quot;</span><span class="content">town.zip</span><span class="delimiter">&quot;</span></span>, ZipLocator.class);
        <span class="local-variable">this</span>.scene = (Node) am.loadModel(<span class="string"><span class="delimiter">&quot;</span><span class="content">main.scene</span><span class="delimiter">&quot;</span></span>);
        <span class="local-variable">this</span>.ambient = <span class="keyword">new</span> AmbientLight();
        <span class="local-variable">this</span>.sun = <span class="keyword">new</span> DirectionalLight();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(AppStateManager stateManager, Application app)
    {
        <span class="comment">//Main Scene loading</span>

        <span class="local-variable">this</span>.scene.setLocalScale(<span class="float">0.1f</span>);
        <span class="local-variable">this</span>.scene.scale(<span class="float">32.0f</span>);
        <span class="comment">//</span>
        <span class="local-variable">this</span>.sun.setDirection(<span class="keyword">new</span> Vector3f(<span class="float">1.4f</span>, -<span class="float">1.4f</span>, -<span class="float">1.4f</span>));
        <span class="local-variable">this</span>.scene.setLocalTranslation(Vector3f.ZERO);
        <span class="comment">//</span>

        rootNode.attachChild(<span class="local-variable">this</span>.scene);
        rootNode.addLight(<span class="local-variable">this</span>.ambient);
        rootNode.addLight(<span class="local-variable">this</span>.sun);
    }

    <span class="comment">/**
     @return the scene
     */</span>
    <span class="directive">public</span> Node getScene()
    {
        <span class="keyword">return</span> scene;
    }
}</code></pre></div></div>
<div class="paragraph"><p>—TheGame.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey3.chasecam</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.SimpleApplication</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TheGame</span> <span class="directive">extends</span> SimpleApplication
{

    <span class="directive">private</span> ApplicationContext applicationContext;

    <span class="directive">public</span> TheGame()
    {
    }

    <span class="comment">//</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args)
    {
        TheGame game = <span class="keyword">new</span> TheGame();
        game.setShowSettings(<span class="predefined-constant">false</span>);
        game.start();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleInitApp()
    {
        <span class="local-variable">this</span>.applicationContext = <span class="keyword">new</span> ApplicationContext(stateManager, assetManager, settings, inputManager, rootNode, cam, flyCam);
        <span class="comment">//</span>
        stateManager.attach(applicationContext);
    }
}</code></pre></div></div>
<div class="paragraph"><p>—Debug.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey.utils</span>;

<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.asset.AssetManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.material.Material</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.ColorRGBA</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Geometry</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.debug.Arrow</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.debug.Grid</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.debug.SkeletonDebugger</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.shape.Line</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.jmonkey.utils.SpatialUtils.makeGeometry</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Debug</span>
{

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> showNodeAxes(AssetManager am, Node n, <span class="type">float</span> axisLen)
    {
        Vector3f v = <span class="keyword">new</span> Vector3f(axisLen, <span class="integer">0</span>, <span class="integer">0</span>);
        Arrow a = <span class="keyword">new</span> Arrow(v);
        Material mat = <span class="keyword">new</span> Material(am, <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>);
        mat.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, ColorRGBA.Red);
        Geometry geom = <span class="keyword">new</span> Geometry(n.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">XAxis</span><span class="delimiter">&quot;</span></span>, a);
        geom.setMaterial(mat);
        n.attachChild(geom);


        <span class="comment">//</span>
        v = <span class="keyword">new</span> Vector3f(<span class="integer">0</span>, axisLen, <span class="integer">0</span>);
        a = <span class="keyword">new</span> Arrow(v);
        mat = <span class="keyword">new</span> Material(am, <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>);
        mat.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, ColorRGBA.Green);
        geom = <span class="keyword">new</span> Geometry(n.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">YAxis</span><span class="delimiter">&quot;</span></span>, a);
        geom.setMaterial(mat);
        n.attachChild(geom);


        <span class="comment">//</span>
        v = <span class="keyword">new</span> Vector3f(<span class="integer">0</span>, <span class="integer">0</span>, axisLen);
        a = <span class="keyword">new</span> Arrow(v);
        mat = <span class="keyword">new</span> Material(am, <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>);
        mat.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, ColorRGBA.Blue);
        geom = <span class="keyword">new</span> Geometry(n.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">ZAxis</span><span class="delimiter">&quot;</span></span>, a);
        geom.setMaterial(mat);
        n.attachChild(geom);
    }

    <span class="comment">//</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> showVector3fArrow(AssetManager am, Node n, Vector3f v, ColorRGBA color, <span class="predefined-type">String</span> name)
    {
        Arrow a = <span class="keyword">new</span> Arrow(v);
        Material mat = MaterialUtils.makeMaterial(am, <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>, color);
        Geometry geom = makeGeometry(a, mat, name);
        n.attachChild(geom);
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> showVector3fLine(AssetManager am, Node n, Vector3f v, ColorRGBA color, <span class="predefined-type">String</span> name)
    {
        <span class="predefined-type">Line</span> l = <span class="keyword">new</span> <span class="predefined-type">Line</span>(v.subtract(v), v);
        Material mat = MaterialUtils.makeMaterial(am, <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>, color);
        Geometry geom = makeGeometry(l, mat, name);
        n.attachChild(geom);
    }

<span class="comment">//Skeleton Debugger</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> attachSkeleton(AssetManager am, Node player, AnimControl control)
    {
        SkeletonDebugger skeletonDebug = <span class="keyword">new</span> SkeletonDebugger(<span class="string"><span class="delimiter">&quot;</span><span class="content">skeleton</span><span class="delimiter">&quot;</span></span>, control.getSkeleton());
        Material mat2 = <span class="keyword">new</span> Material(am, <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>);
        mat2.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, ColorRGBA.Yellow);
        mat2.getAdditionalRenderState().setDepthTest(<span class="predefined-constant">false</span>);
        skeletonDebug.setMaterial(mat2);
        player.attachChild(skeletonDebug);
    }

    <span class="comment">///</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> attachWireFrameDebugGrid(AssetManager assetManager, Node n, Vector3f pos, <span class="predefined-type">Integer</span> size, ColorRGBA color)
    {
        Geometry g = <span class="keyword">new</span> Geometry(<span class="string"><span class="delimiter">&quot;</span><span class="content">wireFrameDebugGrid</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Grid(size, size, <span class="float">1.0f</span>));<span class="comment">//1WU</span>
        Material mat = <span class="keyword">new</span> Material(assetManager, <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>);
        mat.getAdditionalRenderState().setWireframe(<span class="predefined-constant">true</span>);
        mat.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, color);
        g.setMaterial(mat);
        g.center().move(pos);
        n.attachChild(g);
    }
}</code></pre></div></div>
<div class="paragraph"><p>—MaterialUtils.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey.utils</span>;

<span class="keyword">import</span> <span class="include">com.jme3.asset.AssetManager</span>;
<span class="keyword">import</span> <span class="include">com.jme3.material.Material</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.ColorRGBA</span>;

<span class="comment">/*
 Chase camera (aka 3rd person camera) example
 Based on official TestQ3.java

 @author Alex Cham aka Jcrypto
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MaterialUtils</span>
{

    <span class="directive">public</span> MaterialUtils()
    {
    }


    <span class="comment">//&quot;Common/MatDefs/Misc/Unshaded.j3md&quot;</span>
    <span class="directive">public</span> <span class="directive">static</span> Material makeMaterial(AssetManager am, <span class="predefined-type">String</span> name, ColorRGBA color)
    {
        Material mat = <span class="keyword">new</span> Material(am, name);
        mat.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, color);
        <span class="keyword">return</span> mat;
    }
}</code></pre></div></div>
<div class="paragraph"><p>—SpatialUtils.java</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.jmonkey.utils</span>;

<span class="keyword">import</span> <span class="include">com.jme3.material.Material</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Geometry</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Mesh</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;

<span class="comment">/**

 @author java
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpatialUtils</span>
{
    <span class="comment">//</span>
    <span class="directive">public</span> <span class="directive">static</span> Node makeNode(<span class="predefined-type">String</span> name)
    {
        Node n = <span class="keyword">new</span> Node(name);
        <span class="keyword">return</span> n;
    }

<span class="comment">//</span>
    <span class="directive">public</span> <span class="directive">static</span> Geometry makeGeometry(Mesh mesh, Material mat, <span class="predefined-type">String</span> name)
    {
        Geometry geom = <span class="keyword">new</span> Geometry(name, mesh);
        geom.setMaterial(mat);
        <span class="keyword">return</span> geom;
    }

    <span class="comment">//</span>
    <span class="directive">public</span> <span class="directive">static</span> Geometry makeGeometry(Vector3f loc, Vector3f scl, Mesh mesh, Material mat, <span class="predefined-type">String</span> name)
    {
        Geometry geom = <span class="keyword">new</span> Geometry(name, mesh);
        geom.setMaterial(mat);
        geom.setLocalTranslation(loc);
        geom.setLocalScale(scl);
        <span class="keyword">return</span> geom;
    }
}</code></pre></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2017-11-14 05:28:25 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>